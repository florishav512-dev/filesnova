import{t as J,c as Ht,e as Kt,s as Ft,a as gn,b as yn,d as eo,f as Ie,g as oe,l as wn,h as Be,T as Mt,i as no,p as ro,m as io,j as Lr,k as bn,n as oo,o as se,r as Hr,q as Nr,u as Ce,v as xn,w as so,x as uo,y as ue,z as Wr,A as zr,B as ao,C as fo,D as lo,E as co,F as ho}from"./BackgroundRemoverPage-Doxgv-f9.js";import{c as wr}from"./index-B-P-8OYA.js";import"./JsonLd-DLR9jh9w.js";import"./jszip.min-BodG_fE3.js";import"./jszip.min-BpOuR_85.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./UploadZone-CmbkFF6-.js";import"./upload-DpPaOGPK.js";import"./createLucideIcon-LAAGRmDe.js";import"./AdSpace-Cygjr-g5.js";import"./ToolsMenu-CrK1CbmZ.js";import"./FILESNOVANEWICON-BHe6sz7Q.js";import"./toolSeoData-OE8wvMu-.js";import"./eraser-CarB4jxS.js";import"./shield-Dt44Dboq.js";import"./zap-BPLFS2HC.js";import"./download-C9i67Vn3.js";var fn={},br;function po(){return br||(br=1,(function(){var r;function s(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var o=typeof Object.defineProperties=="function"?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t};function a(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof wr=="object"&&wr];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}var c=a(this);function h(t,e){if(e)t:{var n=c;t=t.split(".");for(var i=0;i<t.length-1;i++){var u=t[i];if(!(u in n))break t;n=n[u]}t=t[t.length-1],i=n[t],e=e(i),e!=i&&e!=null&&o(n,t,{configurable:!0,writable:!0,value:e})}}h("Symbol",function(t){function e(l){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new n(i+(l||"")+"_"+u++,l)}function n(l,f){this.h=l,o(this,"description",{configurable:!0,writable:!0,value:f})}if(t)return t;n.prototype.toString=function(){return this.h};var i="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",u=0;return e}),h("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<e.length;n++){var i=c[e[n]];typeof i=="function"&&typeof i.prototype[t]!="function"&&o(i.prototype,t,{configurable:!0,writable:!0,value:function(){return d(s(this))}})}return t});function d(t){return t={next:t},t[Symbol.iterator]=function(){return this},t}function m(t){var e=typeof Symbol<"u"&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:s(t)}}function y(t){if(!(t instanceof Array)){t=m(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}var g=typeof Object.assign=="function"?Object.assign:function(t,e){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(t[u]=i[u])}return t};h("Object.assign",function(t){return t||g});var v=typeof Object.create=="function"?Object.create:function(t){function e(){}return e.prototype=t,new e},w;if(typeof Object.setPrototypeOf=="function")w=Object.setPrototypeOf;else{var x;t:{var A={a:!0},S={};try{S.__proto__=A,x=S.a;break t}catch{}x=!1}w=x?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var O=w;function j(t,e){if(t.prototype=v(e.prototype),t.prototype.constructor=t,O)O(t,e);else for(var n in e)if(n!="prototype")if(Object.defineProperties){var i=Object.getOwnPropertyDescriptor(e,n);i&&Object.defineProperty(t,n,i)}else t[n]=e[n];t.za=e.prototype}function F(){this.m=!1,this.j=null,this.i=void 0,this.h=1,this.v=this.s=0,this.l=null}function P(t){if(t.m)throw new TypeError("Generator is already running");t.m=!0}F.prototype.u=function(t){this.i=t};function k(t,e){t.l={ma:e,na:!0},t.h=t.s||t.v}F.prototype.return=function(t){this.l={return:t},this.h=this.v};function T(t,e,n){return t.h=n,{value:e}}function I(t){this.h=new F,this.i=t}function C(t,e){P(t.h);var n=t.h.j;return n?H(t,"return"in n?n.return:function(i){return{value:i,done:!0}},e,t.h.return):(t.h.return(e),L(t))}function H(t,e,n,i){try{var u=e.call(t.h.j,n);if(!(u instanceof Object))throw new TypeError("Iterator result "+u+" is not an object");if(!u.done)return t.h.m=!1,u;var l=u.value}catch(f){return t.h.j=null,k(t.h,f),L(t)}return t.h.j=null,i.call(t.h,l),L(t)}function L(t){for(;t.h.h;)try{var e=t.i(t.h);if(e)return t.h.m=!1,{value:e.value,done:!1}}catch(n){t.h.i=void 0,k(t.h,n)}if(t.h.m=!1,t.h.l){if(e=t.h.l,t.h.l=null,e.na)throw e.ma;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function V(t){this.next=function(e){return P(t.h),t.h.j?e=H(t,t.h.j.next,e,t.h.u):(t.h.u(e),e=L(t)),e},this.throw=function(e){return P(t.h),t.h.j?e=H(t,t.h.j.throw,e,t.h.u):(k(t.h,e),e=L(t)),e},this.return=function(e){return C(t,e)},this[Symbol.iterator]=function(){return this}}function G(t){function e(i){return t.next(i)}function n(i){return t.throw(i)}return new Promise(function(i,u){function l(f){f.done?i(f.value):Promise.resolve(f.value).then(e,n).then(l,u)}l(t.next())})}function B(t){return G(new V(new I(t)))}h("Promise",function(t){function e(f){this.i=0,this.j=void 0,this.h=[],this.u=!1;var p=this.l();try{f(p.resolve,p.reject)}catch(b){p.reject(b)}}function n(){this.h=null}function i(f){return f instanceof e?f:new e(function(p){p(f)})}if(t)return t;n.prototype.i=function(f){if(this.h==null){this.h=[];var p=this;this.j(function(){p.m()})}this.h.push(f)};var u=c.setTimeout;n.prototype.j=function(f){u(f,0)},n.prototype.m=function(){for(;this.h&&this.h.length;){var f=this.h;this.h=[];for(var p=0;p<f.length;++p){var b=f[p];f[p]=null;try{b()}catch(E){this.l(E)}}}this.h=null},n.prototype.l=function(f){this.j(function(){throw f})},e.prototype.l=function(){function f(E){return function(M){b||(b=!0,E.call(p,M))}}var p=this,b=!1;return{resolve:f(this.I),reject:f(this.m)}},e.prototype.I=function(f){if(f===this)this.m(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.L(f);else{t:switch(typeof f){case"object":var p=f!=null;break t;case"function":p=!0;break t;default:p=!1}p?this.F(f):this.s(f)}},e.prototype.F=function(f){var p=void 0;try{p=f.then}catch(b){this.m(b);return}typeof p=="function"?this.M(p,f):this.s(f)},e.prototype.m=function(f){this.v(2,f)},e.prototype.s=function(f){this.v(1,f)},e.prototype.v=function(f,p){if(this.i!=0)throw Error("Cannot settle("+f+", "+p+"): Promise already settled in state"+this.i);this.i=f,this.j=p,this.i===2&&this.K(),this.H()},e.prototype.K=function(){var f=this;u(function(){if(f.D()){var p=c.console;typeof p<"u"&&p.error(f.j)}},1)},e.prototype.D=function(){if(this.u)return!1;var f=c.CustomEvent,p=c.Event,b=c.dispatchEvent;return typeof b>"u"?!0:(typeof f=="function"?f=new f("unhandledrejection",{cancelable:!0}):typeof p=="function"?f=new p("unhandledrejection",{cancelable:!0}):(f=c.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f)),f.promise=this,f.reason=this.j,b(f))},e.prototype.H=function(){if(this.h!=null){for(var f=0;f<this.h.length;++f)l.i(this.h[f]);this.h=null}};var l=new n;return e.prototype.L=function(f){var p=this.l();f.T(p.resolve,p.reject)},e.prototype.M=function(f,p){var b=this.l();try{f.call(p,b.resolve,b.reject)}catch(E){b.reject(E)}},e.prototype.then=function(f,p){function b(R,_){return typeof R=="function"?function(D){try{E(R(D))}catch(z){M(z)}}:_}var E,M,U=new e(function(R,_){E=R,M=_});return this.T(b(f,E),b(p,M)),U},e.prototype.catch=function(f){return this.then(void 0,f)},e.prototype.T=function(f,p){function b(){switch(E.i){case 1:f(E.j);break;case 2:p(E.j);break;default:throw Error("Unexpected state: "+E.i)}}var E=this;this.h==null?l.i(b):this.h.push(b),this.u=!0},e.resolve=i,e.reject=function(f){return new e(function(p,b){b(f)})},e.race=function(f){return new e(function(p,b){for(var E=m(f),M=E.next();!M.done;M=E.next())i(M.value).T(p,b)})},e.all=function(f){var p=m(f),b=p.next();return b.done?i([]):new e(function(E,M){function U(D){return function(z){R[D]=z,_--,_==0&&E(R)}}var R=[],_=0;do R.push(void 0),_++,i(b.value).T(U(R.length-1),M),b=p.next();while(!b.done)})},e});function $(t,e){t instanceof String&&(t+="");var n=0,i=!1,u={next:function(){if(!i&&n<t.length){var l=n++;return{value:e(l,t[l]),done:!1}}return i=!0,{done:!0,value:void 0}}};return u[Symbol.iterator]=function(){return u},u}h("Array.prototype.keys",function(t){return t||function(){return $(this,function(e){return e})}}),h("Array.prototype.fill",function(t){return t||function(e,n,i){var u=this.length||0;for(0>n&&(n=Math.max(0,u+n)),(i==null||i>u)&&(i=u),i=Number(i),0>i&&(i=Math.max(0,u+i)),n=Number(n||0);n<i;n++)this[n]=e;return this}});function X(t){return t||Array.prototype.fill}h("Int8Array.prototype.fill",X),h("Uint8Array.prototype.fill",X),h("Uint8ClampedArray.prototype.fill",X),h("Int16Array.prototype.fill",X),h("Uint16Array.prototype.fill",X),h("Int32Array.prototype.fill",X),h("Uint32Array.prototype.fill",X),h("Float32Array.prototype.fill",X),h("Float64Array.prototype.fill",X),h("Object.is",function(t){return t||function(e,n){return e===n?e!==0||1/e===1/n:e!==e&&n!==n}}),h("Array.prototype.includes",function(t){return t||function(e,n){var i=this;i instanceof String&&(i=String(i));var u=i.length;for(n=n||0,0>n&&(n=Math.max(n+u,0));n<u;n++){var l=i[n];if(l===e||Object.is(l,e))return!0}return!1}}),h("String.prototype.includes",function(t){return t||function(e,n){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(e,n||0)!==-1}});var tt=this||self;function et(t,e){t=t.split(".");var n=tt;t[0]in n||typeof n.execScript>"u"||n.execScript("var "+t[0]);for(var i;t.length&&(i=t.shift());)t.length||e===void 0?n[i]&&n[i]!==Object.prototype[i]?n=n[i]:n=n[i]={}:n[i]=e}function nt(t){var e;t:{if((e=tt.navigator)&&(e=e.userAgent))break t;e=""}return e.indexOf(t)!=-1}var ut=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,i=Array(n),u=typeof t=="string"?t.split(""):t,l=0;l<n;l++)l in u&&(i[l]=e.call(void 0,u[l],l,t));return i},vt={},lt=null;function Rt(t){var e=t.length,n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);var i=new Uint8Array(n),u=0;return kt(t,function(l){i[u++]=l}),u!==n?i.subarray(0,u):i}function kt(t,e){function n(b){for(;i<t.length;){var E=t.charAt(i++),M=lt[E];if(M!=null)return M;if(!/^[\s\xa0]*$/.test(E))throw Error("Unknown base64 encoding at char: "+E)}return b}Et();for(var i=0;;){var u=n(-1),l=n(0),f=n(64),p=n(64);if(p===64&&u===-1)break;e(u<<2|l>>4),f!=64&&(e(l<<4&240|f>>2),p!=64&&e(f<<6&192|p))}}function Et(){if(!lt){lt={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var i=t.concat(e[n].split(""));vt[n]=i;for(var u=0;u<i.length;u++){var l=i[u];lt[l]===void 0&&(lt[l]=u)}}}}var ct=typeof Uint8Array<"u",ht=!(nt("Trident")||nt("MSIE"))&&typeof tt.btoa=="function";function mt(t){if(!ht){var e;e===void 0&&(e=0),Et(),e=vt[e];for(var n=Array(Math.floor(t.length/3)),i=e[64]||"",u=0,l=0;u<t.length-2;u+=3){var f=t[u],p=t[u+1],b=t[u+2],E=e[f>>2];f=e[(f&3)<<4|p>>4],p=e[(p&15)<<2|b>>6],b=e[b&63],n[l++]=E+f+p+b}switch(E=0,b=i,t.length-u){case 2:E=t[u+1],b=e[(E&15)<<2]||i;case 1:t=t[u],n[l]=e[t>>2]+e[(t&3)<<4|E>>4]+b+i}return n.join("")}for(e="";10240<t.length;)e+=String.fromCharCode.apply(null,t.subarray(0,10240)),t=t.subarray(10240);return e+=String.fromCharCode.apply(null,t),btoa(e)}var dt=RegExp("[-_.]","g");function Ot(t){switch(t){case"-":return"+";case"_":return"/";case".":return"=";default:return""}}function jt(t){if(!ht)return Rt(t);dt.test(t)&&(t=t.replace(dt,Ot)),t=atob(t);for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}var It;function Wt(){return It||(It=new Uint8Array(0))}var Bt={},ai=typeof Uint8Array.prototype.slice=="function",q=0,st=0;function On(t){var e=0>t;t=Math.abs(t);var n=t>>>0;t=Math.floor((t-n)/4294967296),e&&(n=m(Tn(n,t)),e=n.next().value,t=n.next().value,n=e),q=n>>>0,st=t>>>0}var fi=typeof BigInt=="function";function Tn(t,e){return e=~e,t?t=~t+1:e+=1,[t,e]}function Mn(t,e){this.i=t>>>0,this.h=e>>>0}function jn(t){if(!t)return _n||(_n=new Mn(0,0));if(!/^-?\d+$/.test(t))return null;if(16>t.length)On(Number(t));else if(fi)t=BigInt(t),q=Number(t&BigInt(4294967295))>>>0,st=Number(t>>BigInt(32)&BigInt(4294967295));else{var e=+(t[0]==="-");st=q=0;for(var n=t.length,i=e,u=(n-e)%6+e;u<=n;i=u,u+=6)i=Number(t.slice(i,u)),st*=1e6,q=1e6*q+i,4294967296<=q&&(st+=q/4294967296|0,q%=4294967296);e&&(e=m(Tn(q,st)),t=e.next().value,e=e.next().value,q=t,st=e)}return new Mn(q,st)}var _n;function Fn(t,e){return Error("Invalid wire type: "+t+" (at position "+e+")")}function Ne(){return Error("Failed to read varint, encoding is invalid.")}function Pn(t,e){return Error("Tried to read past the end of the data "+e+" > "+t)}function Ct(){throw Error("Invalid UTF8")}function Rn(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}var le=void 0,We,li=typeof TextDecoder<"u",kn,ci=typeof TextEncoder<"u",In;function Bn(t){if(t!==Bt)throw Error("illegal external caller")}function Yt(t,e){if(Bn(e),this.V=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}function ze(){return In||(In=new Yt(null,Bt))}function Cn(t){Bn(Bt);var e=t.V;return e=e==null||ct&&e!=null&&e instanceof Uint8Array?e:typeof e=="string"?jt(e):null,e==null?e:t.V=e}function hi(t){if(typeof t=="string")return{buffer:jt(t),C:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Uint8Array)return{buffer:t,C:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),C:!1};if(t.constructor===Yt)return{buffer:Cn(t)||Wt(),C:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),C:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function Un(t,e){this.i=null,this.m=!1,this.h=this.j=this.l=0,Ve(this,t,e)}function Ve(t,e,n){n=n===void 0?{}:n,t.S=n.S===void 0?!1:n.S,e&&(e=hi(e),t.i=e.buffer,t.m=e.C,t.l=0,t.j=t.i.length,t.h=t.l)}Un.prototype.reset=function(){this.h=this.l};function Ut(t,e){if(t.h=e,e>t.j)throw Pn(t.j,e)}function Qt(t){var e=t.i,n=t.h,i=e[n++],u=i&127;if(i&128&&(i=e[n++],u|=(i&127)<<7,i&128&&(i=e[n++],u|=(i&127)<<14,i&128&&(i=e[n++],u|=(i&127)<<21,i&128&&(i=e[n++],u|=i<<28,i&128&&e[n++]&128&&e[n++]&128&&e[n++]&128&&e[n++]&128&&e[n++]&128)))))throw Ne();return Ut(t,n),u}function Dn(t,e){if(0>e)throw Error("Tried to read a negative byte length: "+e);var n=t.h,i=n+e;if(i>t.j)throw Pn(e,t.j-n);return t.h=i,n}var Ln=[];function Ge(){this.h=[]}Ge.prototype.length=function(){return this.h.length},Ge.prototype.end=function(){var t=this.h;return this.h=[],t};function Hn(t,e,n){for(;0<n||127<e;)t.h.push(e&127|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.h.push(e)}function Dt(t,e){for(;127<e;)t.h.push(e&127|128),e>>>=7;t.h.push(e)}function Ke(t,e){if(Ln.length){var n=Ln.pop();Ve(n,t,e),t=n}else t=new Un(t,e);this.h=t,this.j=this.h.h,this.i=this.l=-1,this.setOptions(e)}Ke.prototype.setOptions=function(t){t=t===void 0?{}:t,this.ca=t.ca===void 0?!1:t.ca},Ke.prototype.reset=function(){this.h.reset(),this.j=this.h.h,this.i=this.l=-1};function Nn(t){var e=t.h;if(e.h==e.j)return!1;t.j=t.h.h;var n=Qt(t.h)>>>0;if(e=n>>>3,n&=7,!(0<=n&&5>=n))throw Fn(n,t.j);if(1>e)throw Error("Invalid field number: "+e+" (at position "+t.j+")");return t.l=e,t.i=n,!0}function ce(t){switch(t.i){case 0:if(t.i!=0)ce(t);else t:{t=t.h;for(var e=t.h,n=e+10,i=t.i;e<n;)if((i[e++]&128)===0){Ut(t,e);break t}throw Ne()}break;case 1:t=t.h,Ut(t,t.h+8);break;case 2:t.i!=2?ce(t):(e=Qt(t.h)>>>0,t=t.h,Ut(t,t.h+e));break;case 5:t=t.h,Ut(t,t.h+4);break;case 3:e=t.l;do{if(!Nn(t))throw Error("Unmatched start-group tag: stream EOF");if(t.i==4){if(t.l!=e)throw Error("Unmatched end-group tag");break}ce(t)}while(!0);break;default:throw Fn(t.i,t.j)}}var he=[];function di(){this.j=[],this.i=0,this.h=new Ge}function zt(t,e){e.length!==0&&(t.j.push(e),t.i+=e.length)}function pi(t,e){if(e=e.R){zt(t,t.h.end());for(var n=0;n<e.length;n++)zt(t,Cn(e[n])||Wt())}}var Tt=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol():void 0;function Lt(t,e){return Tt?t[Tt]|=e:t.A!==void 0?t.A|=e:(Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}}),e)}function Wn(t,e){Tt?t[Tt]&&(t[Tt]&=~e):t.A!==void 0&&(t.A&=~e)}function Z(t){var e;return Tt?e=t[Tt]:e=t.A,e??0}function bt(t,e){Tt?t[Tt]=e:t.A!==void 0?t.A=e:Object.defineProperties(t,{A:{value:e,configurable:!0,writable:!0,enumerable:!1}})}function Xe(t){return Lt(t,1),t}function vi(t,e){bt(e,(t|0)&-51)}function de(t,e){bt(e,(t|18)&-41)}var Ye={};function pe(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}var Zt,zn=[];bt(zn,23),Zt=Object.freeze(zn);function Qe(t){if(Z(t.o)&2)throw Error("Cannot mutate an immutable Message")}function Ze(t){var e=t.length;(e=e?t[e-1]:void 0)&&pe(e)?e.g=1:(e={},t.push((e.g=1,e)))}function Vn(t){var e=t.i+t.G;return t.B||(t.B=t.o[e]={})}function gt(t,e){return e===-1?null:e>=t.i?t.B?t.B[e]:void 0:t.o[e+t.G]}function xt(t,e,n,i){Qe(t),$t(t,e,n,i)}function $t(t,e,n,i){t.j&&(t.j=void 0),e>=t.i||i?Vn(t)[e]=n:(t.o[e+t.G]=n,(t=t.B)&&e in t&&delete t[e])}function $e(t,e,n,i){var u=gt(t,e);Array.isArray(u)||(u=Zt);var l=Z(u);if(l&1||Xe(u),i)l&2||Lt(u,2),n&1||Object.freeze(u);else{i=!(n&2);var f=l&2;n&1||!f?i&&l&16&&!f&&Wn(u,16):(u=Xe(Array.prototype.slice.call(u)),$t(t,e,u))}return u}function Je(t,e){var n=gt(t,e),i=n==null?n:typeof n=="number"||n==="NaN"||n==="Infinity"||n==="-Infinity"?Number(n):void 0;return i!=null&&i!==n&&$t(t,e,i),i}function Gn(t,e,n,i,u){t.h||(t.h={});var l=t.h[n],f=$e(t,n,3,u);if(!l){var p=f;l=[];var b=!!(Z(t.o)&16);f=!!(Z(p)&2);var E=p;!u&&f&&(p=Array.prototype.slice.call(p));for(var M=f,U=0;U<p.length;U++){var R=p[U],_=e,D=!1;if(D=D===void 0?!1:D,R=Array.isArray(R)?new _(R):D?new _:void 0,R!==void 0){_=R.o;var z=D=Z(_);f&&(z|=2),b&&(z|=16),z!=D&&bt(_,z),_=z,M=M||!!(2&_),l.push(R)}}return t.h[n]=l,b=Z(p),e=b|33,e=M?e&-9:e|8,b!=e&&(M=p,Object.isFrozen(M)&&(M=Array.prototype.slice.call(M)),bt(M,e),p=M),E!==p&&$t(t,n,p),(u||i&&f)&&Lt(l,2),i&&Object.freeze(l),l}return u||(u=Object.isFrozen(l),i&&!u?Object.freeze(l):!i&&u&&(l=Array.prototype.slice.call(l),t.h[n]=l)),l}function qe(t,e,n){var i=!!(Z(t.o)&2);if(e=Gn(t,e,n,i,i),t=$e(t,n,3,i),!(i||Z(t)&8)){for(i=0;i<e.length;i++){if(n=e[i],Z(n.o)&2){var u=$n(n,!1);u.j=n}else u=n;n!==u&&(e[i]=u,t[i]=u.o)}Lt(t,8)}return e}function St(t,e,n){if(n!=null&&typeof n!="number")throw Error("Value of float/double field must be a number|null|undefined, found "+typeof n+": "+n);xt(t,e,n)}function Kn(t,e,n,i,u){Qe(t);var l=Gn(t,n,e,!1,!1);return n=i??new n,t=$e(t,e,2,!1),u!=null?(l.splice(u,0,n),t.splice(u,0,n.o)):(l.push(n),t.push(n.o)),n.C()&&Wn(t,8),n}function ve(t,e){return t??e}function At(t,e,n){return n=n===void 0?0:n,ve(Je(t,e),n)}var me;function mi(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":if(t)if(Array.isArray(t)){if((Z(t)&128)!==0)return t=Array.prototype.slice.call(t),Ze(t),t}else{if(ct&&t!=null&&t instanceof Uint8Array)return mt(t);if(t instanceof Yt){var e=t.V;return e==null?"":typeof e=="string"?e:t.V=mt(e)}}}return t}function Xn(t,e,n,i){if(t!=null){if(Array.isArray(t))t=tn(t,e,n,i!==void 0);else if(pe(t)){var u={},l;for(l in t)u[l]=Xn(t[l],e,n,i);t=u}else t=e(t,i);return t}}function tn(t,e,n,i){var u=Z(t);i=i?!!(u&16):void 0,t=Array.prototype.slice.call(t);for(var l=0;l<t.length;l++)t[l]=Xn(t[l],e,n,i);return n(u,t),t}function gi(t){return t.ja===Ye?t.toJSON():mi(t)}function yi(t,e){t&128&&Ze(e)}function Yn(t,e,n){if(n=n===void 0?de:n,t!=null){if(ct&&t instanceof Uint8Array)return t.length?new Yt(new Uint8Array(t),Bt):ze();if(Array.isArray(t)){var i=Z(t);return i&2?t:e&&!(i&32)&&(i&16||i===0)?(bt(t,i|2),t):(t=tn(t,Yn,i&4?de:n,!0),e=Z(t),e&4&&e&2&&Object.freeze(t),t)}return t.ja===Ye?Zn(t):t}}function Qn(t,e,n,i,u,l,f){if(t=t.h&&t.h[n]){if(i=Z(t),i&2?i=t:(l=ut(t,Zn),de(i,l),Object.freeze(l),i=l),Qe(e),f=i==null?Zt:Xe([]),i!=null){for(l=!!i.length,t=0;t<i.length;t++){var p=i[t];l=l&&!(Z(p.o)&2),f[t]=p.o}l=(l?8:0)|1,t=Z(f),(t&l)!==l&&(Object.isFrozen(f)&&(f=Array.prototype.slice.call(f)),bt(f,t|l)),e.h||(e.h={}),e.h[n]=i}else e.h&&(e.h[n]=void 0);$t(e,n,f,u)}else xt(e,n,Yn(i,l,f),u)}function Zn(t){return Z(t.o)&2||(t=$n(t,!0),Lt(t.o,2)),t}function $n(t,e){var n=t.o,i=[];Lt(i,16);var u=t.constructor.h;if(u&&i.push(u),u=t.B,u){i.length=n.length,i.fill(void 0,i.length,n.length);var l={};i[i.length-1]=l}(Z(n)&128)!==0&&Ze(i),e=e||t.C()?de:vi,l=t.constructor,me=i,i=new l(i),me=void 0,t.R&&(i.R=t.R.slice()),l=!!(Z(n)&16);for(var f=u?n.length-1:n.length,p=0;p<f;p++)Qn(t,i,p-t.G,n[p],!1,l,e);if(u)for(var b in u)Qn(t,i,+b,u[b],!0,l,e);return i}function at(t,e,n){t==null&&(t=me),me=void 0;var i=this.constructor.i||0,u=0<i,l=this.constructor.h,f=!1;if(t==null){t=l?[l]:[];var p=48,b=!0;u&&(i=0,p|=128),bt(t,p)}else{if(!Array.isArray(t)||l&&l!==t[0])throw Error();var E=p=Lt(t,0);if((b=(16&E)!==0)&&((f=(32&E)!==0)||(E|=32)),u){if(128&E)i=0;else if(0<t.length){var M=t[t.length-1];if(pe(M)&&"g"in M){i=0,E|=128,delete M.g;var U=!0,R;for(R in M){U=!1;break}U&&t.pop()}}}else if(128&E)throw Error();p!==E&&bt(t,E)}this.G=(l?0:-1)-i,this.h=void 0,this.o=t;t:{if(l=this.o.length,i=l-1,l&&(l=this.o[i],pe(l))){this.B=l,this.i=i-this.G;break t}e!==void 0&&-1<e?(this.i=Math.max(e,i+1-this.G),this.B=void 0):this.i=Number.MAX_VALUE}if(!u&&this.B&&"g"in this.B)throw Error('Unexpected "g" flag in sparse object of message that is not a group type.');if(n){e=b&&!f&&!0,u=this.i;var _;for(b=0;b<n.length;b++)f=n[b],f<u?(f+=this.G,(i=t[f])?Jn(i,e):t[f]=Zt):(_||(_=Vn(this)),(i=_[f])?Jn(i,e):_[f]=Zt)}}at.prototype.toJSON=function(){return tn(this.o,gi,yi)},at.prototype.C=function(){return!!(Z(this.o)&2)};function Jn(t,e){if(Array.isArray(t)){var n=Z(t),i=1;!e||n&2||(i|=16),(n&i)!==i&&bt(t,n|i)}}at.prototype.ja=Ye,at.prototype.toString=function(){return this.o.toString()};function qn(t,e,n){if(n){var i={},u;for(u in n){var l=n[u],f=l.ra;f||(i.J=l.xa||l.oa.W,l.ia?(i.aa=ir(l.ia),f=(function(p){return function(b,E,M){return p.J(b,E,M,p.aa)}})(i)):l.ka?(i.Z=or(l.da.P,l.ka),f=(function(p){return function(b,E,M){return p.J(b,E,M,p.Z)}})(i)):f=i.J,l.ra=f),f(e,t,l.da),i={J:i.J,aa:i.aa,Z:i.Z}}}pi(e,t)}var ge=Symbol();function tr(t,e,n){return t[ge]||(t[ge]=function(i,u){return e(i,u,n)})}function er(t){var e=t[ge];if(!e){var n=nn(t);e=function(i,u){return sr(i,u,n)},t[ge]=e}return e}function wi(t){var e=t.ia;if(e)return er(e);if(e=t.wa)return tr(t.da.P,e,t.ka)}function bi(t){var e=wi(t),n=t.da,i=t.oa.U;return e?function(u,l){return i(u,l,n,e)}:function(u,l){return i(u,l,n)}}function nr(t,e){var n=t[e];return typeof n=="function"&&n.length===0&&(n=n(),t[e]=n),Array.isArray(n)&&(qt in n||Jt in n||0<n.length&&typeof n[0]=="function")?n:void 0}function rr(t,e,n,i,u,l){e.P=t[0];var f=1;if(t.length>f&&typeof t[f]!="number"){var p=t[f++];n(e,p)}for(;f<t.length;){n=t[f++];for(var b=f+1;b<t.length&&typeof t[b]!="number";)b++;switch(p=t[f++],b-=f,b){case 0:i(e,n,p);break;case 1:(b=nr(t,f))?(f++,u(e,n,p,b)):i(e,n,p,t[f++]);break;case 2:b=f++,b=nr(t,b),u(e,n,p,b,t[f++]);break;case 3:l(e,n,p,t[f++],t[f++],t[f++]);break;case 4:l(e,n,p,t[f++],t[f++],t[f++],t[f++]);break;default:throw Error("unexpected number of binary field arguments: "+b)}}return e}var ye=Symbol();function ir(t){var e=t[ye];if(!e){var n=en(t);e=function(i,u){return ur(i,u,n)},t[ye]=e}return e}function or(t,e){var n=t[ye];return n||(n=function(i,u){return qn(i,u,e)},t[ye]=n),n}var Jt=Symbol();function xi(t,e){t.push(e)}function Si(t,e,n){t.push(e,n.W)}function Ai(t,e,n,i){var u=ir(i),l=en(i).P,f=n.W;t.push(e,function(p,b,E){return f(p,b,E,l,u)})}function Ei(t,e,n,i,u,l){var f=or(i,l),p=n.W;t.push(e,function(b,E,M){return p(b,E,M,i,f)})}function en(t){var e=t[Jt];return e||(e=rr(t,t[Jt]=[],xi,Si,Ai,Ei),qt in t&&Jt in t&&(t.length=0),e)}var qt=Symbol();function Oi(t,e){t[0]=e}function Ti(t,e,n,i){var u=n.U;t[e]=i?function(l,f,p){return u(l,f,p,i)}:u}function Mi(t,e,n,i,u){var l=n.U,f=er(i),p=nn(i).P;t[e]=function(b,E,M){return l(b,E,M,p,f,u)}}function ji(t,e,n,i,u,l,f){var p=n.U,b=tr(i,u,l);t[e]=function(E,M,U){return p(E,M,U,i,b,f)}}function nn(t){var e=t[qt];return e||(e=rr(t,t[qt]={},Oi,Ti,Mi,ji),qt in t&&Jt in t&&(t.length=0),e)}function sr(t,e,n){for(;Nn(e)&&e.i!=4;){var i=e.l,u=n[i];if(!u){var l=n[0];l&&(l=l[i])&&(u=n[i]=bi(l))}if(!u||!u(e,t,i)){u=e,i=t,l=u.j,ce(u);var f=u;if(!f.ca){if(u=f.h.h-l,f.h.h=l,f=f.h,u==0)u=ze();else{if(l=Dn(f,u),f.S&&f.m)u=f.i.subarray(l,l+u);else{f=f.i;var p=l;u=l+u,u=p===u?Wt():ai?f.slice(p,u):new Uint8Array(f.subarray(p,u))}u=u.length==0?ze():new Yt(u,Bt)}(l=i.R)?l.push(u):i.R=[u]}}}return t}function ur(t,e,n){for(var i=n.length,u=i%2==1,l=u?1:0;l<i;l+=2)(0,n[l+1])(e,t,n[l]);qn(t,e,u?n[0]:void 0)}function te(t,e){return{U:t,W:e}}var yt=te(function(t,e,n){if(t.i!==5)return!1;t=t.h;var i=t.i,u=t.h,l=i[u],f=i[u+1],p=i[u+2];return i=i[u+3],Ut(t,t.h+4),f=(l<<0|f<<8|p<<16|i<<24)>>>0,t=2*(f>>31)+1,l=f>>>23&255,f&=8388607,xt(e,n,l==255?f?NaN:1/0*t:l==0?t*Math.pow(2,-149)*f:t*Math.pow(2,l-150)*(f+Math.pow(2,23))),!0},function(t,e,n){if(e=Je(e,n),e!=null){Dt(t.h,8*n+5),t=t.h;var i=+e;i===0?0<1/i?q=st=0:(st=0,q=2147483648):isNaN(i)?(st=0,q=2147483647):(i=(n=0>i?-2147483648:0)?-i:i,34028234663852886e22<i?(st=0,q=(n|2139095040)>>>0):11754943508222875e-54>i?(i=Math.round(i/Math.pow(2,-149)),st=0,q=(n|i)>>>0):(e=Math.floor(Math.log(i)/Math.LN2),i*=Math.pow(2,-e),i=Math.round(8388608*i),16777216<=i&&++e,st=0,q=(n|e+127<<23|i&8388607)>>>0)),n=q,t.h.push(n>>>0&255),t.h.push(n>>>8&255),t.h.push(n>>>16&255),t.h.push(n>>>24&255)}}),_i=te(function(t,e,n){if(t.i!==0)return!1;var i=t.h,u=0,l=t=0,f=i.i,p=i.h;do{var b=f[p++];u|=(b&127)<<l,l+=7}while(32>l&&b&128);for(32<l&&(t|=(b&127)>>4),l=3;32>l&&b&128;l+=7)b=f[p++],t|=(b&127)<<l;if(Ut(i,p),128>b)i=u>>>0,b=t>>>0,(t=b&2147483648)&&(i=~i+1>>>0,b=~b>>>0,i==0&&(b=b+1>>>0)),i=4294967296*b+(i>>>0);else throw Ne();return xt(e,n,t?-i:i),!0},function(t,e,n){e=gt(e,n),e!=null&&(typeof e=="string"&&jn(e),e!=null&&(Dt(t.h,8*n),typeof e=="number"?(t=t.h,On(e),Hn(t,q,st)):(n=jn(e),Hn(t.h,n.i,n.h))))}),Fi=te(function(t,e,n){return t.i!==0?!1:(xt(e,n,Qt(t.h)),!0)},function(t,e,n){if(e=gt(e,n),e!=null&&e!=null)if(Dt(t.h,8*n),t=t.h,n=e,0<=n)Dt(t,n);else{for(e=0;9>e;e++)t.h.push(n&127|128),n>>=7;t.h.push(1)}}),ar=te(function(t,e,n){if(t.i!==2)return!1;var i=Qt(t.h)>>>0;t=t.h;var u=Dn(t,i);if(t=t.i,li){var l=t,f;(f=We)||(f=We=new TextDecoder("utf-8",{fatal:!0})),t=u+i,l=u===0&&t===l.length?l:l.subarray(u,t);try{var p=f.decode(l)}catch(U){if(le===void 0){try{f.decode(new Uint8Array([128]))}catch{}try{f.decode(new Uint8Array([97])),le=!0}catch{le=!1}}throw!le&&(We=void 0),U}}else{p=u,i=p+i,u=[];for(var b=null,E,M;p<i;)E=t[p++],128>E?u.push(E):224>E?p>=i?Ct():(M=t[p++],194>E||(M&192)!==128?(p--,Ct()):u.push((E&31)<<6|M&63)):240>E?p>=i-1?Ct():(M=t[p++],(M&192)!==128||E===224&&160>M||E===237&&160<=M||((l=t[p++])&192)!==128?(p--,Ct()):u.push((E&15)<<12|(M&63)<<6|l&63)):244>=E?p>=i-2?Ct():(M=t[p++],(M&192)!==128||(E<<28)+(M-144)>>30!==0||((l=t[p++])&192)!==128||((f=t[p++])&192)!==128?(p--,Ct()):(E=(E&7)<<18|(M&63)<<12|(l&63)<<6|f&63,E-=65536,u.push((E>>10&1023)+55296,(E&1023)+56320))):Ct(),8192<=u.length&&(b=Rn(b,u),u.length=0);p=Rn(b,u)}return xt(e,n,p),!0},function(t,e,n){if(e=gt(e,n),e!=null){var i=!1;if(i=i===void 0?!1:i,ci){if(i&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(e))throw Error("Found an unpaired surrogate");e=(kn||(kn=new TextEncoder)).encode(e)}else{for(var u=0,l=new Uint8Array(3*e.length),f=0;f<e.length;f++){var p=e.charCodeAt(f);if(128>p)l[u++]=p;else{if(2048>p)l[u++]=p>>6|192;else{if(55296<=p&&57343>=p){if(56319>=p&&f<e.length){var b=e.charCodeAt(++f);if(56320<=b&&57343>=b){p=1024*(p-55296)+b-56320+65536,l[u++]=p>>18|240,l[u++]=p>>12&63|128,l[u++]=p>>6&63|128,l[u++]=p&63|128;continue}else f--}if(i)throw Error("Found an unpaired surrogate");p=65533}l[u++]=p>>12|224,l[u++]=p>>6&63|128}l[u++]=p&63|128}}e=u===l.length?l:l.subarray(0,u)}Dt(t.h,8*n+2),Dt(t.h,e.length),zt(t,t.h.end()),zt(t,e)}}),fr=te(function(t,e,n,i,u){if(t.i!==2)return!1;e=Kn(e,n,i),n=t.h.j,i=Qt(t.h)>>>0;var l=t.h.h+i,f=l-n;if(0>=f&&(t.h.j=l,u(e,t,void 0,void 0,void 0),f=l-t.h.h),f)throw Error("Message parsing ended unexpectedly. Expected to read "+(i+" bytes, instead read "+(i-f)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return t.h.h=l,t.h.j=n,!0},function(t,e,n,i,u){if(e=qe(e,i,n),e!=null)for(i=0;i<e.length;i++){var l=t;Dt(l.h,8*n+2);var f=l.h.end();zt(l,f),f.push(l.i),l=f,u(e[i],t),f=t;var p=l.pop();for(p=f.i+f.h.length()-p;127<p;)l.push(p&127|128),p>>>=7,f.i++;l.push(p),f.i++}});function rn(t){return function(e,n){t:{if(he.length){var i=he.pop();i.setOptions(n),Ve(i.h,e,n),e=i}else e=new Ke(e,n);try{var u=nn(t),l=sr(new u.P,e,u);break t}finally{u=e.h,u.i=null,u.m=!1,u.l=0,u.j=0,u.h=0,u.S=!1,e.l=-1,e.i=-1,100>he.length&&he.push(e)}l=void 0}return l}}function on(t){return function(){var e=new di;ur(this,e,en(t)),zt(e,e.h.end());for(var n=new Uint8Array(e.i),i=e.j,u=i.length,l=0,f=0;f<u;f++){var p=i[f];n.set(p,l),l+=p.length}return e.j=[n],n}}function Vt(t){at.call(this,t)}j(Vt,at);var lr=[Vt,1,Fi,2,yt,3,ar,4,ar];Vt.prototype.l=on(lr);function sn(t){at.call(this,t,-1,Pi)}j(sn,at),sn.prototype.addClassification=function(t,e){return Kn(this,1,Vt,t,e),this};var Pi=[1],Ri=rn([sn,1,fr,lr]);function ee(t){at.call(this,t)}j(ee,at);var cr=[ee,1,yt,2,yt,3,yt,4,yt,5,yt];ee.prototype.l=on(cr);function hr(t){at.call(this,t,-1,ki)}j(hr,at);var ki=[1],Ii=rn([hr,1,fr,cr]);function we(t){at.call(this,t)}j(we,at);var dr=[we,1,yt,2,yt,3,yt,4,yt,5,yt,6,_i],Bi=rn(dr);we.prototype.l=on(dr);function pr(t,e,n){if(n=t.createShader(n===0?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+t.getShaderInfoLog(n));return n}function Ci(t){return qe(t,Vt,1).map(function(e){var n=gt(e,1);return{index:n??0,qa:At(e,2),label:gt(e,3)!=null?ve(gt(e,3),""):void 0,displayName:gt(e,4)!=null?ve(gt(e,4),""):void 0}})}function Ui(t){return{x:At(t,1),y:At(t,2),z:At(t,3),visibility:Je(t,4)!=null?At(t,4):void 0}}function un(t,e){this.i=t,this.h=e,this.m=0}function vr(t,e,n){return Di(t,e),typeof t.h.canvas.transferToImageBitmap=="function"?Promise.resolve(t.h.canvas.transferToImageBitmap()):n?Promise.resolve(t.h.canvas):typeof createImageBitmap=="function"?createImageBitmap(t.h.canvas):(t.j===void 0&&(t.j=document.createElement("canvas")),new Promise(function(i){t.j.height=t.h.canvas.height,t.j.width=t.h.canvas.width,t.j.getContext("2d",{}).drawImage(t.h.canvas,0,0,t.h.canvas.width,t.h.canvas.height),i(t.j)}))}function Di(t,e){var n=t.h;if(t.s===void 0){var i=pr(n,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),u=pr(n,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),l=n.createProgram();if(n.attachShader(l,i),n.attachShader(l,u),n.linkProgram(l),!n.getProgramParameter(l,n.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+n.getProgramInfoLog(l));i=t.s=l,n.useProgram(i),u=n.getUniformLocation(i,"sampler0"),t.l={O:n.getAttribLocation(i,"aVertex"),N:n.getAttribLocation(i,"aTex"),ya:u},t.v=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.v),n.enableVertexAttribArray(t.l.O),n.vertexAttribPointer(t.l.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),t.u=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.enableVertexAttribArray(t.l.N),n.vertexAttribPointer(t.l.N,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(u,0)}i=t.l,n.useProgram(t.s),n.canvas.width=e.width,n.canvas.height=e.height,n.viewport(0,0,e.width,e.height),n.activeTexture(n.TEXTURE0),t.i.bindTexture2d(e.glName),n.enableVertexAttribArray(i.O),n.bindBuffer(n.ARRAY_BUFFER,t.v),n.vertexAttribPointer(i.O,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(i.N),n.bindBuffer(n.ARRAY_BUFFER,t.u),n.vertexAttribPointer(i.N,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(i.O),n.disableVertexAttribArray(i.N),n.bindBuffer(n.ARRAY_BUFFER,null),t.i.bindTexture2d(0)}function Li(t){this.h=t}var Hi=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Ni(t,e){return e+t}function mr(t,e){window[t]=e}function Wi(t){var e=document.createElement("script");return e.setAttribute("src",t),e.setAttribute("crossorigin","anonymous"),new Promise(function(n){e.addEventListener("load",function(){n()},!1),e.addEventListener("error",function(){n()},!1),document.body.appendChild(e)})}function zi(){return B(function(t){switch(t.h){case 1:return t.s=2,T(t,WebAssembly.instantiate(Hi),4);case 4:t.h=3,t.s=0;break;case 2:return t.s=0,t.l=null,t.return(!1);case 3:return t.return(!0)}})}function an(t){if(this.h=t,this.listeners={},this.l={},this.L={},this.s={},this.v={},this.M=this.u=this.ga=!0,this.I=Promise.resolve(),this.fa="",this.D={},this.locateFile=t&&t.locateFile||Ni,typeof window=="object")var e=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")e=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.ha=e,t.options){e=m(Object.keys(t.options));for(var n=e.next();!n.done;n=e.next()){n=n.value;var i=t.options[n].default;i!==void 0&&(this.l[n]=typeof i=="function"?i():i)}}}r=an.prototype,r.close=function(){return this.j&&this.j.delete(),Promise.resolve()};function Vi(t){var e,n,i,u,l,f,p,b,E,M,U;return B(function(R){switch(R.h){case 1:return t.ga?(e=t.h.files===void 0?[]:typeof t.h.files=="function"?t.h.files(t.l):t.h.files,T(R,zi(),2)):R.return();case 2:if(n=R.i,typeof window=="object")return mr("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),mr("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),f=e.filter(function(_){return _.data!==void 0}),p=e.filter(function(_){return _.data===void 0}),b=Promise.all(f.map(function(_){var D=be(t,_.url);if(_.path!==void 0){var z=_.path;D=D.then(function(Q){return t.overrideFile(z,Q),Promise.resolve(Q)})}return D})),E=Promise.all(p.map(function(_){return _.simd===void 0||_.simd&&n||!_.simd&&!n?Wi(t.locateFile(_.url,t.ha)):Promise.resolve()})).then(function(){var _,D,z;return B(function(Q){if(Q.h==1)return _=window.createMediapipeSolutionsWasm,D=window.createMediapipeSolutionsPackedAssets,z=t,T(Q,_(D),2);z.i=Q.i,Q.h=0})}),M=(function(){return B(function(_){return t.h.graph&&t.h.graph.url?_=T(_,be(t,t.h.graph.url),0):(_.h=0,_=void 0),_})})(),T(R,Promise.all([E,b,M]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return i=e.filter(function(_){return _.simd===void 0||_.simd&&n||!_.simd&&!n}).map(function(_){return t.locateFile(_.url,t.ha)}),importScripts.apply(null,y(i)),u=t,T(R,createMediapipeSolutionsWasm(Module),6);case 6:u.i=R.i,t.m=new OffscreenCanvas(1,1),t.i.canvas=t.m,l=t.i.GL.createContext(t.m,{antialias:!1,alpha:!1,va:typeof WebGL2RenderingContext<"u"?2:1}),t.i.GL.makeContextCurrent(l),R.h=4;break;case 7:if(t.m=document.createElement("canvas"),U=t.m.getContext("webgl2",{}),!U&&(U=t.m.getContext("webgl",{}),!U))return alert("Failed to create WebGL canvas context when passing video frame."),R.return();t.K=U,t.i.canvas=t.m,t.i.createContext(t.m,!0,!0,{});case 4:t.j=new t.i.SolutionWasm,t.ga=!1,R.h=0}})}function Gi(t){var e,n,i,u,l,f,p,b;return B(function(E){if(E.h==1){if(t.h.graph&&t.h.graph.url&&t.fa===t.h.graph.url)return E.return();if(t.u=!0,!t.h.graph||!t.h.graph.url){E.h=2;return}return t.fa=t.h.graph.url,T(E,be(t,t.h.graph.url),3)}for(E.h!=2&&(e=E.i,t.j.loadGraph(e)),n=m(Object.keys(t.D)),i=n.next();!i.done;i=n.next())u=i.value,t.j.overrideFile(u,t.D[u]);if(t.D={},t.h.listeners)for(l=m(t.h.listeners),f=l.next();!f.done;f=l.next())p=f.value,Qi(t,p);b=t.l,t.l={},t.setOptions(b),E.h=0})}r.reset=function(){var t=this;return B(function(e){t.j&&(t.j.reset(),t.s={},t.v={}),e.h=0})},r.setOptions=function(t,e){var n=this;if(e=e||this.h.options){for(var i=[],u=[],l={},f=m(Object.keys(t)),p=f.next();!p.done;l={X:l.X,Y:l.Y},p=f.next())if(p=p.value,!(p in this.l&&this.l[p]===t[p])){this.l[p]=t[p];var b=e[p];b!==void 0&&(b.onChange&&(l.X=b.onChange,l.Y=t[p],i.push((function(E){return function(){var M;return B(function(U){if(U.h==1)return T(U,E.X(E.Y),2);M=U.i,M===!0&&(n.u=!0),U.h=0})}})(l))),b.graphOptionXref&&(p=Object.assign({},{calculatorName:"",calculatorIndex:0},b.graphOptionXref,{valueNumber:b.type===1?t[p]:0,valueBoolean:b.type===0?t[p]:!1,valueString:b.type===2?t[p]:""}),u.push(p)))}(i.length!==0||u.length!==0)&&(this.u=!0,this.H=(this.H===void 0?[]:this.H).concat(u),this.F=(this.F===void 0?[]:this.F).concat(i))}};function Ki(t){var e,n,i,u,l,f,p;return B(function(b){switch(b.h){case 1:if(!t.u)return b.return();if(!t.F){b.h=2;break}e=m(t.F),n=e.next();case 3:if(n.done){b.h=5;break}return i=n.value,T(b,i(),4);case 4:n=e.next(),b.h=3;break;case 5:t.F=void 0;case 2:if(t.H){for(u=new t.i.GraphOptionChangeRequestList,l=m(t.H),f=l.next();!f.done;f=l.next())p=f.value,u.push_back(p);t.j.changeOptions(u),u.delete(),t.H=void 0}t.u=!1,b.h=0}})}r.initialize=function(){var t=this;return B(function(e){return e.h==1?T(e,Vi(t),2):e.h!=3?T(e,Gi(t),3):T(e,Ki(t),0)})};function be(t,e){var n,i;return B(function(u){return e in t.L?u.return(t.L[e]):(n=t.locateFile(e,""),i=fetch(n).then(function(l){return l.arrayBuffer()}),t.L[e]=i,u.return(i))})}r.overrideFile=function(t,e){this.j?this.j.overrideFile(t,e):this.D[t]=e},r.clearOverriddenFiles=function(){this.D={},this.j&&this.j.clearOverriddenFiles()},r.send=function(t,e){var n=this,i,u,l,f,p,b,E,M,U;return B(function(R){switch(R.h){case 1:return n.h.inputs?(i=1e3*(e??performance.now()),T(R,n.I,2)):R.return();case 2:return T(R,n.initialize(),3);case 3:for(u=new n.i.PacketDataList,l=m(Object.keys(t)),f=l.next();!f.done;f=l.next())if(p=f.value,b=n.h.inputs[p]){t:{var _=t[p];switch(b.type){case"video":var D=n.s[b.stream];if(D||(D=new un(n.i,n.K),n.s[b.stream]=D),D.m===0&&(D.m=D.i.createTexture()),typeof HTMLVideoElement<"u"&&_ instanceof HTMLVideoElement)var z=_.videoWidth,Q=_.videoHeight;else typeof HTMLImageElement<"u"&&_ instanceof HTMLImageElement?(z=_.naturalWidth,Q=_.naturalHeight):(z=_.width,Q=_.height);Q={glName:D.m,width:z,height:Q},z=D.h,z.canvas.width=Q.width,z.canvas.height=Q.height,z.activeTexture(z.TEXTURE0),D.i.bindTexture2d(D.m),z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,_),D.i.bindTexture2d(0),D=Q;break t;case"detections":for(D=n.s[b.stream],D||(D=new Li(n.i),n.s[b.stream]=D),D.data||(D.data=new D.h.DetectionListData),D.data.reset(_.length),Q=0;Q<_.length;++Q){z=_[Q];var Y=D.data,rt=Y.setBoundingBox,pt=Q,ft=z.la,K=new we;if(St(K,1,ft.sa),St(K,2,ft.ta),St(K,3,ft.height),St(K,4,ft.width),St(K,5,ft.rotation),xt(K,6,ft.pa),ft=K.l(),rt.call(Y,pt,ft),z.ea)for(Y=0;Y<z.ea.length;++Y){K=z.ea[Y],rt=D.data,pt=rt.addNormalizedLandmark,ft=Q,K=Object.assign({},K,{visibility:K.visibility?K.visibility:0});var it=new ee;St(it,1,K.x),St(it,2,K.y),St(it,3,K.z),K.visibility&&St(it,4,K.visibility),K=it.l(),pt.call(rt,ft,K)}if(z.ba)for(Y=0;Y<z.ba.length;++Y)rt=D.data,pt=rt.addClassification,ft=Q,K=z.ba[Y],it=new Vt,St(it,2,K.qa),K.index&&xt(it,1,K.index),K.label&&xt(it,3,K.label),K.displayName&&xt(it,4,K.displayName),K=it.l(),pt.call(rt,ft,K)}D=D.data;break t;default:D={}}}switch(E=D,M=b.stream,b.type){case"video":u.pushTexture2d(Object.assign({},E,{stream:M,timestamp:i}));break;case"detections":U=E,U.stream=M,U.timestamp=i,u.pushDetectionList(U);break;default:throw Error("Unknown input config type: '"+b.type+"'")}}return n.j.send(u),T(R,n.I,4);case 4:u.delete(),R.h=0}})};function Xi(t,e,n){var i,u,l,f,p,b,E,M,U,R,_,D,z,Q;return B(function(Y){switch(Y.h){case 1:if(!n)return Y.return(e);for(i={},u=0,l=m(Object.keys(n)),f=l.next();!f.done;f=l.next())p=f.value,b=n[p],typeof b!="string"&&b.type==="texture"&&e[b.stream]!==void 0&&++u;1<u&&(t.M=!1),E=m(Object.keys(n)),f=E.next();case 2:if(f.done){Y.h=4;break}if(M=f.value,U=n[M],typeof U=="string")return z=i,Q=M,T(Y,Yi(t,M,e[U]),14);if(R=e[U.stream],U.type==="detection_list"){if(R){for(var rt=R.getRectList(),pt=R.getLandmarksList(),ft=R.getClassificationsList(),K=[],it=0;it<rt.size();++it){var _t=Bi(rt.get(it)),Zi=At(_t,1),$i=At(_t,2),Ji=At(_t,3),qi=At(_t,4),to=At(_t,5,0),xe=void 0;xe=xe===void 0?0:xe,_t={la:{sa:Zi,ta:$i,height:Ji,width:qi,rotation:to,pa:ve(gt(_t,6),xe)},ea:qe(Ii(pt.get(it)),ee,1).map(Ui),ba:Ci(Ri(ft.get(it)))},K.push(_t)}rt=K}else rt=[];i[M]=rt,Y.h=7;break}if(U.type==="proto_list"){if(R){for(rt=Array(R.size()),pt=0;pt<R.size();pt++)rt[pt]=R.get(pt);R.delete()}else rt=[];i[M]=rt,Y.h=7;break}if(R===void 0){Y.h=3;break}if(U.type==="float_list"){i[M]=R,Y.h=7;break}if(U.type==="proto"){i[M]=R,Y.h=7;break}if(U.type!=="texture")throw Error("Unknown output config type: '"+U.type+"'");return _=t.v[M],_||(_=new un(t.i,t.K),t.v[M]=_),T(Y,vr(_,R,t.M),13);case 13:D=Y.i,i[M]=D;case 7:U.transform&&i[M]&&(i[M]=U.transform(i[M])),Y.h=3;break;case 14:z[Q]=Y.i;case 3:f=E.next(),Y.h=2;break;case 4:return Y.return(i)}})}function Yi(t,e,n){var i;return B(function(u){return typeof n=="number"||n instanceof Uint8Array||n instanceof t.i.Uint8BlobList?u.return(n):n instanceof t.i.Texture2dDataOut?(i=t.v[e],i||(i=new un(t.i,t.K),t.v[e]=i),u.return(vr(i,n,t.M))):u.return(void 0)})}function Qi(t,e){for(var n=e.name||"$",i=[].concat(y(e.wants)),u=new t.i.StringList,l=m(e.wants),f=l.next();!f.done;f=l.next())u.push_back(f.value);l=t.i.PacketListener.implement({onResults:function(p){for(var b={},E=0;E<e.wants.length;++E)b[i[E]]=p.get(E);var M=t.listeners[n];M&&(t.I=Xi(t,b,e.outs).then(function(U){U=M(U);for(var R=0;R<e.wants.length;++R){var _=b[i[R]];typeof _=="object"&&_.hasOwnProperty&&_.hasOwnProperty("delete")&&_.delete()}U&&(t.I=U)}))}}),t.j.attachMultiListener(u,l),u.delete()}r.onResults=function(t,e){this.listeners[e||"$"]=t},et("Solution",an),et("OptionType",{BOOL:0,NUMBER:1,ua:2,0:"BOOL",1:"NUMBER",2:"STRING"});function gr(t){switch(t===void 0&&(t=0),t){case 1:return"selfie_segmentation_landscape.tflite";default:return"selfie_segmentation.tflite"}}function yr(t){var e=this;t=t||{},this.h=new an({locateFile:t.locateFile,files:function(n){return[{simd:!0,url:"selfie_segmentation_solution_simd_wasm_bin.js"},{simd:!1,url:"selfie_segmentation_solution_wasm_bin.js"},{data:!0,url:gr(n.modelSelection)}]},graph:{url:"selfie_segmentation.binarypb"},listeners:[{wants:["segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window!="object"||window.navigator===void 0?!1:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelSelection:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelSelection",fieldName:"int_value"},onChange:function(n){var i,u,l;return B(function(f){return f.h==1?(i=gr(n),u="third_party/mediapipe/modules/selfie_segmentation/"+i,T(f,be(e.h,i),2)):(l=f.i,e.h.overrideFile(u,l),f.return(!0))})}}}})}r=yr.prototype,r.close=function(){return this.h.close(),Promise.resolve()},r.onResults=function(t){this.h.onResults(t)},r.initialize=function(){var t=this;return B(function(e){return T(e,t.h.initialize(),0)})},r.reset=function(){this.h.reset()},r.send=function(t){var e=this;return B(function(n){return T(n,e.h.send(t),0)})},r.setOptions=function(t){this.h.setOptions(t)},et("SelfieSegmentation",yr),et("VERSION","0.1.1675465747")}).call(fn)),fn}var vo=po();/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var vn=function(r,s){return vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var c in a)a.hasOwnProperty(c)&&(o[c]=a[c])},vn(r,s)};function Vr(r,s){function o(){this.constructor=r}vn(r,s),r.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}var ot=function(){return ot=Object.assign||function(r){for(var s,o=1,a=arguments.length;o<a;o++)for(var c in s=arguments[o])Object.prototype.hasOwnProperty.call(s,c)&&(r[c]=s[c]);return r},ot.apply(this,arguments)};function N(r,s,o,a){return new(o||(o=Promise))((function(c,h){function d(g){try{y(a.next(g))}catch(v){h(v)}}function m(g){try{y(a.throw(g))}catch(v){h(v)}}function y(g){var v;g.done?c(g.value):(v=g.value,v instanceof o?v:new o((function(w){w(v)}))).then(d,m)}y((a=a.apply(r,[])).next())}))}function W(r,s){var o,a,c,h,d={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return h={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function m(y){return function(g){return(function(v){if(o)throw new TypeError("Generator is already executing.");for(;d;)try{if(o=1,a&&(c=2&v[0]?a.return:v[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,v[1])).done)return c;switch(a=0,c&&(v=[2&v[0],c.value]),v[0]){case 0:case 1:c=v;break;case 4:return d.label++,{value:v[1],done:!1};case 5:d.label++,a=v[1],v=[0];continue;case 7:v=d.ops.pop(),d.trys.pop();continue;default:if(c=d.trys,!((c=c.length>0&&c[c.length-1])||v[0]!==6&&v[0]!==2)){d=0;continue}if(v[0]===3&&(!c||v[1]>c[0]&&v[1]<c[3])){d.label=v[1];break}if(v[0]===6&&d.label<c[1]){d.label=c[1],c=v;break}if(c&&d.label<c[2]){d.label=c[2],d.ops.push(v);break}c[2]&&d.ops.pop(),d.trys.pop();continue}v=s.call(r,d)}catch(w){v=[6,w],a=0}finally{o=c=0}if(5&v[0])throw v[1];return{value:v[0]?v[1]:void 0,done:!0}})([y,g])}}}function Fe(r){return r instanceof SVGAnimatedLength?r.baseVal.value:r}function Sn(r){return N(this,void 0,void 0,(function(){var s,o;return W(this,(function(a){switch(a.label){case 0:return s=document.createElement("canvas"),r instanceof Mt?[4,Be(r,s)]:[3,2];case 1:return a.sent(),[3,3];case 2:s.width=Fe(r.width),s.height=Fe(r.height),o=s.getContext("2d"),r instanceof ImageData?o.putImageData(r,0,0):o.drawImage(r,0,0),a.label=3;case 3:return[2,s]}}))}))}function Gr(r){return N(this,void 0,void 0,(function(){var s,o,a,c,h,d;return W(this,(function(m){switch(m.label){case 0:return r instanceof Mt?(s=r.shape.slice(0,2),o=s[0],a=s[1],c=ImageData.bind,[4,Be(r)]):[3,2];case 1:return[2,new(c.apply(ImageData,[void 0,m.sent(),a,o]))];case 2:return h=document.createElement("canvas"),d=h.getContext("2d"),h.width=Fe(r.width),h.height=Fe(r.height),d.drawImage(r,0,0),[2,d.getImageData(0,0,h.width,h.height)]}}))}))}function Kr(r){return N(this,void 0,void 0,(function(){var s,o;return W(this,(function(a){switch(a.label){case 0:return r instanceof SVGImageElement||r instanceof OffscreenCanvas?[4,Sn(r)]:[3,2];case 1:return o=a.sent(),[3,3];case 2:o=r,a.label=3;case 3:return s=o,[2,bn(s,4)]}}))}))}function ae(r){if(r<0||r>=256)throw new Error("Mask value must be in range [0, 255] but got "+r);if(!Number.isInteger(r))throw new Error("Mask value must be an integer but got "+r)}var ln=[[110,64,170],[143,61,178],[178,60,178],[210,62,167],[238,67,149],[255,78,125],[255,94,99],[255,115,75],[255,140,56],[239,167,47],[217,194,49],[194,219,64],[175,240,91],[135,245,87],[96,247,96],[64,243,115],[40,234,141],[28,219,169],[26,199,194],[33,176,213],[47,150,224],[65,125,224],[84,101,214],[99,81,195]];function Es(r){if(ae(r),r<ln.length){var s=ln[r];return{r:s[0],g:s[1],b:s[2],a:255}}throw new Error("Mask value must be in range [0, "+ln.length+")")}function Xr(r){var s=r.shape[2],o=ao(r,2),a=Ce(o,[-1]);return fo(a,s)}function Se(r,s){return J((function(){return Ht(uo(r,ue(s)),"int32")}))}function mo(r,s){var o=s.shape,a=o[0],c=o[1],h=o[2];return J((function(){var d=Xr(s),m=Kt(Hr(0,h,1,"int32"),1),y=Ht(Nr(d,m),"int32"),g=Ce(y,[a,c]),v=Ie(g,ue(1,"int32"));return yn((function(w,x){return xn(w,x)})(v,r),ue(1,"int32"))}))}var Yr=(function(){function r(s,o){this.model=s,this.outputStride=o;var a=this.model.inputs[0].shape;oe(a[1]===-1&&a[2]===-1,(function(){return"Input shape ["+a[1]+", "+a[2]+"] must both be equal to or -1"}))}return r.prototype.predict=function(s){var o=this;return J((function(){var a=o.preprocessInput(Ht(s,"float32")),c=Kt(a,0),h=o.model.predict(c).map((function(m){return Ft(m,[0])})),d=o.nameOutputResults(h);return{heatmapScores:gn(d.heatmap),offsets:d.offsets,displacementFwd:d.displacementFwd,displacementBwd:d.displacementBwd,segmentation:d.segmentation,partHeatmaps:d.partHeatmaps,longOffsets:d.longOffsets,partOffsets:d.partOffsets}}))},r.prototype.dispose=function(){this.model.dispose()},r})(),go=(function(r){function s(){return r!==null&&r.apply(this,arguments)||this}return Vr(s,r),s.prototype.preprocessInput=function(o){return J((function(){return yn(eo(o,127.5),1)}))},s.prototype.nameOutputResults=function(o){return{offsets:o[0],segmentation:o[1],partHeatmaps:o[2],longOffsets:o[3],heatmap:o[4],displacementFwd:o[5],displacementBwd:o[6],partOffsets:o[7]}},s})(Yr),Ue=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"],wt=Ue.length,Pe=Ue.reduce((function(r,s,o){return r[s]=o,r}),{});[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]].map((function(r){var s=r[0],o=r[1];return[Pe[s],Pe[o]]}));function An(r,s,o){var a=r[0],c=r[1],h=s[0],d=s[1],m=o.top,y=o.bottom;return[d/(o.left+o.right+c),h/(m+y+a)]}function Qr(r,s,o,a){return{y:a.get(r,s,o),x:a.get(r,s,o+wt)}}function Zr(r,s,o){var a=Qr(r.heatmapY,r.heatmapX,r.id,o),c=a.y,h=a.x;return{x:r.heatmapX*s+h,y:r.heatmapY*s+c}}function xr(r,s,o){return r<s?s:r>o?o:r}function Sr(r,s){return{x:r.x+s.x,y:r.y+s.y}}function yo(r,s,o){o===void 0&&(o=.3);for(var a=0,c=0,h=0;h<r.length;h++)s.keypoints[h].score>o&&(c+=1,a+=Math.pow(r[h].x-s.keypoints[h].position.x,2)+Math.pow(r[h].y-s.keypoints[h].position.y,2));return c===0?a=1/0:a/=c,a}function wo(r,s,o,a,c,h,d){for(var m=d[0],y=d[1],g=o(r),v=g.y*a+g.x,w=c[wt*(2*v)+s],x=c[wt*(2*v+1)+s],A=r.y+w,S=r.x+x,O=0;O<h;O++){A=Math.min(A,m-1);var j=o({x:S=Math.min(S,y-1),y:A}),F=j.y*a+j.x;A+=w=c[wt*(2*F)+s],S+=x=c[wt*(2*F+1)+s]}return{x:S,y:A}}function $r(r,s,o,a,c,h,d,m,y,g){for(var v=c[0],w=c[1],x=h[0],A=h[1],S=m[0],O=m[1],j=[],F=function(L){return(function(V,G,B,$){var X=G[0],tt=G[1],et=B[0],nt=B[1],ut=Math.round(((X+V.y+1)*nt-1)/$);return{x:Math.round(((tt+V.x+1)*et-1)/$),y:ut}})(L,[v,w],[x,A],y)},P=0;P<a;P++){var k=wo(r,P,F,d,s,g,[S,O]);j.push(k)}for(var T=-1,I=1/0,C=0;C<o.length;C++){var H=yo(j,o[C]);H<I&&(T=C,I=H)}return T}function Jr(r,s){var o=r[0],a=r[1];return[Math.round((a-1)/s+1),Math.round((o-1)/s+1)]}function qr(r,s,o,a,c,h,d,m,y,g,v){for(var w=d[0],x=d[1],A=r.shape,S=A[0],O=A[1],j=s.shape.slice(0,2),F=j[0],P=j[1],k=Ce(s,[F,P,2,wt]),T=new Float32Array(v*wt*3).fill(0),I=0;I<o.length;I++)for(var C=I*wt*3,H=o[I],L=0;L<wt;L++){var V=H.keypoints[L],G=C+3*L;T[G]=V.score,T[G+1]=V.position.y,T[G+2]=V.position.x}var B=An([a,c],[w,x],m),$=B[0],X=B[1],tt=co(T,[v,wt,3]),et=m.top,nt=m.left,ut={variableNames:["segmentation","longOffsets","poses"],outputShape:[S,O],userCode:`
    int convertToPositionInOutput(int pos, int pad, float scale, int stride) {
      return round(((float(pos + pad) + 1.0) * scale - 1.0) / float(stride));
    }

    float convertToPositionInOutputFloat(
        int pos, int pad, float scale, int stride) {
      return ((float(pos + pad) + 1.0) * scale - 1.0) / float(stride);
    }

    float dist(float x1, float y1, float x2, float y2) {
      return pow(x1 - x2, 2.0) + pow(y1 - y2, 2.0);
    }

    float sampleLongOffsets(float h, float w, int d, int k) {
      float fh = fract(h);
      float fw = fract(w);
      int clH = int(ceil(h));
      int clW = int(ceil(w));
      int flH = int(floor(h));
      int flW = int(floor(w));
      float o11 = getLongOffsets(flH, flW, d, k);
      float o12 = getLongOffsets(flH, clW, d, k);
      float o21 = getLongOffsets(clH, flW, d, k);
      float o22 = getLongOffsets(clH, clW, d, k);
      float o1 = mix(o11, o12, fw);
      float o2 = mix(o21, o22, fw);
      return mix(o1, o2, fh);
    }

    int findNearestPose(int h, int w) {
      float prob = getSegmentation(h, w);
      if (prob < 1.0) {
        return -1;
      }

      // Done(Tyler): convert from output space h/w to strided space.
      float stridedH = convertToPositionInOutputFloat(
        h, `+et+", "+X+", "+h+`);
      float stridedW = convertToPositionInOutputFloat(
        w, `+nt+", "+$+", "+h+`);

      float minDist = 1000000.0;
      int iMin = -1;
      for (int i = 0; i < `+v+`; i++) {
        float curDistSum = 0.0;
        int numKpt = 0;
        for (int k = 0; k < `+wt+`; k++) {
          float dy = sampleLongOffsets(stridedH, stridedW, 0, k);
          float dx = sampleLongOffsets(stridedH, stridedW, 1, k);

          float y = float(h) + dy;
          float x = float(w) + dx;

          for (int s = 0; s < `+y+`; s++) {
            int yRounded = round(min(y, float(`+(a-1)+`)));
            int xRounded = round(min(x, float(`+(c-1)+`)));

            float yStrided = convertToPositionInOutputFloat(
              yRounded, `+et+", "+X+", "+h+`);
            float xStrided = convertToPositionInOutputFloat(
              xRounded, `+nt+", "+$+", "+h+`);

            float dy = sampleLongOffsets(yStrided, xStrided, 0, k);
            float dx = sampleLongOffsets(yStrided, xStrided, 1, k);

            y = y + dy;
            x = x + dx;
          }

          float poseScore = getPoses(i, k, 0);
          float poseY = getPoses(i, k, 1);
          float poseX = getPoses(i, k, 2);
          if (poseScore > `+g+`) {
            numKpt = numKpt + 1;
            curDistSum = curDistSum + dist(x, y, poseX, poseY);
          }
        }
        if (numKpt > 0 && curDistSum / float(numKpt) < minDist) {
          minDist = curDistSum / float(numKpt);
          iMin = i;
        }
      }
      return iMin;
    }

    void main() {
        ivec2 coords = getOutputCoords();
        int nearestPose = findNearestPose(coords[0], coords[1]);
        setOutput(float(nearestPose));
      }
  `};return ho().compileAndRun(ut,[r,k,tt])}function ti(){return lo()==="webgl"}function bo(r,s,o,a,c,h,d,m,y,g,v,w){var x=d[0],A=d[1];return y===void 0&&(y=.2),g===void 0&&(g=8),v===void 0&&(v=.3),w===void 0&&(w=10),N(this,void 0,void 0,(function(){var S,O,j,F,P;return W(this,(function(k){switch(k.label){case 0:return S=o.filter((function(T){return T.score>=y})),ti()?(j=J((function(){var T=qr(r,s,S,a,c,h,[x,A],m,g,v,w),I=Wr().makeTensorFromDataId(T.dataId,T.shape,T.dtype);return S.map((function(C,H){return(function(L,V){return J((function(){return Ht(zr(L,ue(V)),"int32")}))})(I,H)}))})),[4,Promise.all(j.map((function(T){return T.data()})))]):[3,2];case 1:return O=k.sent(),j.forEach((function(T){return T.dispose()})),[3,5];case 2:return[4,r.data()];case 3:return F=k.sent(),[4,s.data()];case 4:P=k.sent(),O=(function(T,I,C,H,L,V,G,B,$,X){var tt=G[0],et=G[1];X===void 0&&(X=5);for(var nt=C.map((function(Ot){return new Uint8Array(H*L).fill(0)})),ut=B.top,vt=B.left,lt=An([H,L],[tt,et],B),Rt=lt[0],kt=lt[1],Et=Jr([tt,et],V)[0],ct=0;ct<H;ct+=1)for(var ht=0;ht<L;ht+=1){var mt=ct*L+ht;if(T[mt]===1){var dt=$r({x:ht,y:ct},I,C,X,[ut,vt],[Rt,kt],Et,[H,L],V,$);dt>=0&&(nt[dt][mt]=1)}}return nt})(F,P,S,a,c,h,[x,A],m,g),k.label=5;case 5:return[2,O.map((function(T,I){return{data:T,pose:S[I],width:c,height:a}}))]}}))}))}function xo(r,s,o,a,c,h,d,m,y,g,v,w,x){var A=m[0],S=m[1];return g===void 0&&(g=.2),v===void 0&&(v=8),w===void 0&&(w=.3),x===void 0&&(x=10),N(this,void 0,void 0,(function(){var O,j,F,P,k,T;return W(this,(function(I){switch(I.label){case 0:return O=a.filter((function(C){return C.score>=g})),ti()?(F=J((function(){var C=qr(r,s,O,c,h,d,[A,S],y,v,w,x),H=Wr().makeTensorFromDataId(C.dataId,C.shape,C.dtype);return O.map((function(L,V){return(function(G,B,$){return J((function(){return yn(xn(Ht(zr(G,ue($)),"int32"),Ie(B,1)),1)}))})(H,o,V)}))})),[4,Promise.all(F.map((function(C){return C.data()})))]):[3,2];case 1:return j=I.sent(),F.forEach((function(C){return C.dispose()})),[3,6];case 2:return[4,r.data()];case 3:return P=I.sent(),[4,s.data()];case 4:return k=I.sent(),[4,o.data()];case 5:T=I.sent(),j=(function(C,H,L,V,G,B,$,X,tt,et,nt){var ut=X[0],vt=X[1];nt===void 0&&(nt=5);for(var lt=V.map((function(Wt){return new Int32Array(G*B).fill(-1)})),Rt=tt.top,kt=tt.left,Et=An([G,B],[ut,vt],tt),ct=Et[0],ht=Et[1],mt=Jr([ut,vt],$)[0],dt=0;dt<G;dt+=1)for(var Ot=0;Ot<B;Ot+=1){var jt=dt*B+Ot;if(C[jt]===1){var It=$r({x:Ot,y:dt},H,V,nt,[Rt,kt],[ct,ht],mt,[G,B],$,et);It>=0&&(lt[It][jt]=L[jt])}}return lt})(P,k,T,O,c,h,d,[A,S],y,v),I.label=6;case 6:return[2,j.map((function(C,H){return{pose:O[H],data:C,height:c,width:h}}))]}}))}))}function cn(r){return Math.floor(r/2)}var So=(function(){function r(s,o){this.priorityQueue=new Array(s),this.numberOfElements=-1,this.getElementValue=o}return r.prototype.enqueue=function(s){this.priorityQueue[++this.numberOfElements]=s,this.swim(this.numberOfElements)},r.prototype.dequeue=function(){var s=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,s},r.prototype.empty=function(){return this.numberOfElements===-1},r.prototype.size=function(){return this.numberOfElements+1},r.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},r.prototype.max=function(){return this.priorityQueue[0]},r.prototype.swim=function(s){for(;s>0&&this.less(cn(s),s);)this.exchange(s,cn(s)),s=cn(s)},r.prototype.sink=function(s){for(;2*s<=this.numberOfElements;){var o=2*s;if(o<this.numberOfElements&&this.less(o,o+1)&&o++,!this.less(s,o))break;this.exchange(s,o),s=o}},r.prototype.getValueAt=function(s){return this.getElementValue(this.priorityQueue[s])},r.prototype.less=function(s,o){return this.getValueAt(s)<this.getValueAt(o)},r.prototype.exchange=function(s,o){var a=this.priorityQueue[s];this.priorityQueue[s]=this.priorityQueue[o],this.priorityQueue[o]=a},r})();function Ao(r,s,o,a,c,h){for(var d=h.shape,m=d[0],y=d[1],g=!0,v=Math.max(o-c,0),w=Math.min(o+c+1,m),x=v;x<w;++x){for(var A=Math.max(a-c,0),S=Math.min(a+c+1,y),O=A;O<S;++O)if(h.get(x,O,r)>s){g=!1;break}if(!g)break}return g}var ei=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]].map((function(r){var s=r[0],o=r[1];return[Pe[s],Pe[o]]})),hn=ei.map((function(r){return r[1]})),Ar=ei.map((function(r){return r[0]}));function dn(r,s,o,a){return{y:xr(Math.round(r.y/s),0,o-1),x:xr(Math.round(r.x/s),0,a-1)}}function Er(r,s,o,a,c,h,d,m){m===void 0&&(m=2);for(var y=a.shape,g=y[0],v=y[1],w=(function(P,k,T){var I=T.shape[2]/2;return{y:T.get(k.y,k.x,P),x:T.get(k.y,k.x,I+P)}})(r,dn(s.position,h,g,v),d),x=Sr(s.position,w),A=0;A<m;A++){var S=dn(x,h,g,v),O=Qr(S.y,S.x,o,c);x=Sr({x:S.x*h,y:S.y*h},{x:O.x,y:O.y})}var j=dn(x,h,g,v),F=a.get(j.y,j.x,o);return{position:x,part:Ue[o],score:F}}function Eo(r,s,o,a,c,h){var d=s.shape[2],m=hn.length,y=new Array(d),g=r.part,v=r.score,w=Zr(g,a,o);y[g.id]={score:v,part:Ue[g.id],position:w};for(var x=m-1;x>=0;--x){var A=hn[x],S=Ar[x];y[A]&&!y[S]&&(y[S]=Er(x,y[A],S,s,o,a,h))}for(x=0;x<m;++x)A=Ar[x],S=hn[x],y[A]&&!y[S]&&(y[S]=Er(x,y[A],S,s,o,a,c));return y}function ni(r,s,o,a){var c=o.x,h=o.y;return r.some((function(d){var m,y,g,v,w,x,A=d.keypoints[a].position;return m=h,y=c,g=A.y,v=A.x,(w=g-m)*w+(x=v-y)*x<=s}))}function Oo(r,s,o){var a=o.reduce((function(c,h,d){var m=h.position,y=h.score;return ni(r,s,m,d)||(c+=y),c}),0);return a/o.length}function Ae(r,s,o,a,c,h,d,m){d===void 0&&(d=.5),m===void 0&&(m=20);for(var y=[],g=(function(S,O,j){for(var F=j.shape,P=F[0],k=F[1],T=F[2],I=new So(P*k*T,(function(G){return G.score})),C=0;C<P;++C)for(var H=0;H<k;++H)for(var L=0;L<T;++L){var V=j.get(C,H,L);V<S||Ao(L,V,C,H,O,j)&&I.enqueue({score:V,part:{heatmapY:C,heatmapX:H,id:L}})}return I})(d,1,r),v=m*m;y.length<h&&!g.empty();){var w=g.dequeue();if(!ni(y,v,Zr(w.part,c,s),w.part.id)){var x=Eo(w,r,s,c,o,a),A=Oo(y,v,x);y.push({keypoints:x,score:A})}}return y}var ne,To=[-123.15,-115.9,-103.06],Mo=(function(r){function s(){return r!==null&&r.apply(this,arguments)||this}return Vr(s,r),s.prototype.preprocessInput=function(o){return Ie(o,To)},s.prototype.nameOutputResults=function(o){var a=o[0],c=o[1],h=o[2],d=o[3],m=o[4],y=o[5];return{offsets:m,segmentation:o[6],partHeatmaps:y,longOffsets:d,heatmap:h,displacementFwd:c,displacementBwd:a,partOffsets:o[7]}},s})(Yr),Or="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/resnet50/",Tr="https://storage.googleapis.com/tfjs-models/savedmodel/bodypix/mobilenet/";function re(r){if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return(function(s){if("offsetHeight"in s&&s.offsetHeight!==0&&"offsetWidth"in s&&s.offsetWidth!==0)return[s.offsetHeight,s.offsetWidth];if(s.height!=null&&s.width!=null)return[s.height,s.width];throw new Error("HTMLImageElement must have height and width attributes set.")})(r);if(typeof ImageData<"u"&&r instanceof ImageData)return[r.height,r.width];if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return(function(s){return s.hasAttribute("height")&&s.hasAttribute("width")?[s.height,s.width]:[s.videoHeight,s.videoWidth]})(r);if(r instanceof Mt)return[r.shape[0],r.shape[1]];throw new Error("error: Unknown input type: "+r+".")}function Mr(r,s){return(function(o,a){return(o-1)%a==0})(r,s)?r:Math.floor(r/s)*s+1}var ie={low:"low",medium:"medium",high:"high",full:"full"},jo=((ne={})[ie.low]=.25,ne[ie.medium]=.5,ne[ie.high]=.75,ne[ie.full]=1,ne);function Ee(r,s,o){var a=o[0],c=o[1],h=(function(d){if(typeof d=="string"){var m=jo[d];return oe(typeof m=="number",(function(){return"string value of inputResolution must be one of "+Object.values(ie).join(",")+" but was "+d+"."})),m}return oe(typeof d=="number"&&d<=2&&d>=.1,(function(){return"inputResolution must be a string or number between 0.1 and 2, but was "+d})),d})(r);return[Mr(a*h,s),Mr(c*h,s)]}function Gt(r,s,o,a,c){var h=s[0],d=s[1],m=o[0],y=o[1],g=a[0],v=g[0],w=g[1],x=a[1],A=x[0],S=x[1];return J((function(){var O=se.resizeBilinear(r,[m,y],!0);return O=gn(O),(function(j,F,P){var k=F[0],T=F[1],I=P[0],C=I[0],H=I[1],L=P[1],V=L[0],G=L[1];return J((function(){var B=Kt(j);return Ft(se.cropAndResize(B,[[C/(k+C+H-1),V/(T+V+G-1),(C+k-1)/(k+C+H-1),(V+T-1)/(T+V+G-1)]],[0],[k,T]),[0])}))})(O,[h,d],[[v,w],[A,S]])}))}function Oe(r,s){var o=s[0],a=s[1],c=re(r),h=c[0],d=c[1],m=a/o,y=[0,0,0,0],g=y[0],v=y[1],w=y[2],x=y[3];d/h<m?(g=0,v=0,w=Math.round(.5*(m*h-d)),x=Math.round(.5*(m*h-d))):(g=Math.round(.5*(1/m*d-h)),v=Math.round(.5*(1/m*d-h)),w=0,x=0);var A=J((function(){var S=(function(O){return O instanceof Mt?O:bn(O)})(r);return S=so(S,[[g,v],[w,x],[0,0]]),se.resizeBilinear(S,[o,a])}));return{resized:A,padding:{top:g,left:w,right:x,bottom:v}}}function Te(r){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Promise.all(r.map((function(o){return o.buffer()})))]}))}))}function Me(r,s,o,a,c){var h=s[0],d=s[1],m=o[0],y=o[1],g=(function(v,w,x,A,S){return A===void 0&&(A=0),S===void 0&&(S=0),x===1&&w===1&&A===0&&S===0?v:v.map((function(O){return(function(j,F,P,k,T){return k===void 0&&(k=0),T===void 0&&(T=0),{score:j.score,keypoints:j.keypoints.map((function(I){var C=I.score,H=I.part,L=I.position;return{score:C,part:H,position:{x:L.x*P+T,y:L.y*F+k}}}))}})(O,w,x,A,S)}))})(r,(h+a.top+a.bottom)/m,(d+a.left+a.right)/y,-a.top,-a.left);return c?(function(v,w){return w<=0?v:v.map((function(x){return(function(A,S){return{score:A.score,keypoints:A.keypoints.map((function(O){var j=O.score,F=O.part,P=O.position;return{score:j,part:F,position:{x:S-1-P.x,y:P.y}}}))}})(x,w)}))})(g,d):g}var jr={architecture:"MobileNetV1",outputStride:16,quantBytes:4,multiplier:.75},_r=["MobileNetV1","ResNet50"],Fr={MobileNetV1:[8,16,32],ResNet50:[32,16]},Pr={MobileNetV1:[.5,.75,1],ResNet50:[1]},Rr=[1,2,4],je={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20},_e={flipHorizontal:!1,internalResolution:"medium",segmentationThreshold:.7,maxDetections:10,scoreThreshold:.4,nmsRadius:20,minKeypointScore:.3,refineSteps:10};function kr(r){var s=r.segmentationThreshold,o=r.maxDetections,a=r.scoreThreshold,c=r.nmsRadius;if(s<0||s>1)throw new Error("segmentationThreshold "+s+". Should be in range [0.0, 1.0]");if(o<=0)throw new Error("Invalid maxDetections "+o+". Should be > 0");if(a<0||a>1)throw new Error("Invalid scoreThreshold "+a+". Should be in range [0.0, 1.0]");if(c<=0)throw new Error("Invalid nmsRadius "+c+".")}function Ir(r){var s=r.segmentationThreshold,o=r.maxDetections,a=r.scoreThreshold,c=r.nmsRadius,h=r.minKeypointScore,d=r.refineSteps;if(s<0||s>1)throw new Error("segmentationThreshold "+s+". Should be in range [0.0, 1.0]");if(o<=0)throw new Error("Invalid maxDetections "+o+". Should be > 0");if(a<0||a>1)throw new Error("Invalid scoreThreshold "+a+". Should be in range [0.0, 1.0]");if(c<=0)throw new Error("Invalid nmsRadius "+c+".");if(h<0||h>1)throw new Error("Invalid minKeypointScore "+h+".Should be in range [0.0, 1.0]");if(d<=0||d>20)throw new Error("Invalid refineSteps "+d+".Should be in range [1, 20]")}var ri=(function(){function r(s){this.baseModel=s}return r.prototype.predictForPersonSegmentation=function(s){var o=this.baseModel.predict(s);return{segmentLogits:o.segmentation,heatmapScores:o.heatmapScores,offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd}},r.prototype.predictForPersonSegmentationAndPart=function(s){var o=this.baseModel.predict(s);return{segmentLogits:o.segmentation,partHeatmapLogits:o.partHeatmaps,heatmapScores:o.heatmapScores,offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd}},r.prototype.predictForMultiPersonInstanceSegmentationAndPart=function(s){var o=this.baseModel.predict(s);return{segmentLogits:o.segmentation,longOffsets:o.longOffsets,heatmapScores:o.heatmapScores,offsets:o.offsets,displacementFwd:o.displacementFwd,displacementBwd:o.displacementBwd,partHeatmaps:o.partHeatmaps}},r.prototype.segmentPersonActivation=function(s,o,a){var c=this;a===void 0&&(a=.5);var h=re(s),d=h[0],m=h[1],y=Ee(o,this.baseModel.outputStride,[d,m]),g=Oe(s,y),v=g.resized,w=g.padding,x=J((function(){var P=c.predictForPersonSegmentation(v),k=P.segmentLogits,T=P.heatmapScores,I=P.offsets,C=P.displacementFwd,H=P.displacementBwd,L=v.shape,V=L[0],G=L[1],B=Gt(k,[d,m],[V,G],[[w.top,w.bottom],[w.left,w.right]]);return{segmentation:Se(Ft(B),a),heatmapScores:T,offsets:I,displacementFwd:C,displacementBwd:H}})),A=x.segmentation,S=x.heatmapScores,O=x.offsets,j=x.displacementFwd,F=x.displacementBwd;return v.dispose(),{segmentation:A,heatmapScores:S,offsets:O,displacementFwd:j,displacementBwd:F,padding:w,internalResolutionHeightAndWidth:y}},r.prototype.segmentPerson=function(s,o){return o===void 0&&(o=je),N(this,void 0,void 0,(function(){var a,c,h,d,m,y,g,v,w,x,A,S,O,j,F,P,k,T;return W(this,(function(I){switch(I.label){case 0:return kr(o=ot(ot({},je),o)),a=this.segmentPersonActivation(s,o.internalResolution,o.segmentationThreshold),c=a.segmentation,h=a.heatmapScores,d=a.offsets,m=a.displacementFwd,y=a.displacementBwd,g=a.padding,v=a.internalResolutionHeightAndWidth,w=c.shape,x=w[0],A=w[1],[4,c.data()];case 1:return S=I.sent(),c.dispose(),[4,Te([h,d,m,y])];case 2:return O=I.sent(),j=O[0],F=O[1],P=O[2],k=O[3],T=Me(T=Ae(j,F,P,k,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[x,A],v,g,!1),h.dispose(),d.dispose(),m.dispose(),y.dispose(),[2,{height:x,width:A,data:S,allPoses:T}]}}))}))},r.prototype.segmentMultiPerson=function(s,o){return o===void 0&&(o=_e),N(this,void 0,void 0,(function(){var a,c,h,d,m,y,g,v,w,x,A,S,O,j,F,P,k,T,I,C,H,L=this;return W(this,(function(V){switch(V.label){case 0:return Ir(o=ot(ot({},_e),o)),a=re(s),c=a[0],h=a[1],d=Ee(o.internalResolution,this.baseModel.outputStride,[c,h]),m=Oe(s,d),y=m.resized,g=m.padding,v=J((function(){var G,B=L.predictForMultiPersonInstanceSegmentationAndPart(y),$=B.segmentLogits,X=B.longOffsets,tt=B.heatmapScores,et=B.offsets,nt=B.displacementFwd,ut=B.displacementBwd,vt=Gt($,[c,h],d,[[g.top,g.bottom],[g.left,g.right]]);return G=X,{segmentation:Se(Ft(vt),o.segmentationThreshold),longOffsets:G,heatmapScoresRaw:tt,offsetsRaw:et,displacementFwdRaw:nt,displacementBwdRaw:ut}})),w=v.segmentation,x=v.longOffsets,A=v.heatmapScoresRaw,S=v.offsetsRaw,O=v.displacementFwdRaw,j=v.displacementBwdRaw,[4,Te([A,S,O,j])];case 1:return F=V.sent(),P=F[0],k=F[1],T=F[2],I=F[3],C=Me(C=Ae(P,k,T,I,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[c,h],d,g,!1),[4,bo(w,x,C,c,h,this.baseModel.outputStride,d,g,o.scoreThreshold,o.refineSteps,o.minKeypointScore,o.maxDetections)];case 2:return H=V.sent(),y.dispose(),w.dispose(),x.dispose(),A.dispose(),S.dispose(),O.dispose(),j.dispose(),[2,H]}}))}))},r.prototype.segmentPersonPartsActivation=function(s,o,a){var c=this;a===void 0&&(a=.5);var h=re(s),d=h[0],m=h[1],y=Ee(o,this.baseModel.outputStride,[d,m]),g=Oe(s,y),v=g.resized,w=g.padding,x=J((function(){var P=c.predictForPersonSegmentationAndPart(v),k=P.segmentLogits,T=P.partHeatmapLogits,I=P.heatmapScores,C=P.offsets,H=P.displacementFwd,L=P.displacementBwd,V=v.shape,G=V[0],B=V[1],$=Gt(k,[d,m],[G,B],[[w.top,w.bottom],[w.left,w.right]]),X=Gt(T,[d,m],[G,B],[[w.top,w.bottom],[w.left,w.right]]);return{partSegmentation:mo(Se(Ft($),a),X),heatmapScores:I,offsets:C,displacementFwd:H,displacementBwd:L}})),A=x.partSegmentation,S=x.heatmapScores,O=x.offsets,j=x.displacementFwd,F=x.displacementBwd;return v.dispose(),{partSegmentation:A,heatmapScores:S,offsets:O,displacementFwd:j,displacementBwd:F,padding:w,internalResolutionHeightAndWidth:y}},r.prototype.segmentPersonParts=function(s,o){return o===void 0&&(o=je),N(this,void 0,void 0,(function(){var a,c,h,d,m,y,g,v,w,x,A,S,O,j,F,P,k,T;return W(this,(function(I){switch(I.label){case 0:return kr(o=ot(ot({},je),o)),a=this.segmentPersonPartsActivation(s,o.internalResolution,o.segmentationThreshold),c=a.partSegmentation,h=a.heatmapScores,d=a.offsets,m=a.displacementFwd,y=a.displacementBwd,g=a.padding,v=a.internalResolutionHeightAndWidth,w=c.shape,x=w[0],A=w[1],[4,c.data()];case 1:return S=I.sent(),c.dispose(),[4,Te([h,d,m,y])];case 2:return O=I.sent(),j=O[0],F=O[1],P=O[2],k=O[3],T=Me(T=Ae(j,F,P,k,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[x,A],v,g,!1),h.dispose(),d.dispose(),m.dispose(),y.dispose(),[2,{height:x,width:A,data:S,allPoses:T}]}}))}))},r.prototype.segmentMultiPersonParts=function(s,o){return o===void 0&&(o=_e),N(this,void 0,void 0,(function(){var a,c,h,d,m,y,g,v,w,x,A,S,O,j,F,P,k,T,I,C,H,L,V=this;return W(this,(function(G){switch(G.label){case 0:return Ir(o=ot(ot({},_e),o)),a=re(s),c=a[0],h=a[1],d=Ee(o.internalResolution,this.baseModel.outputStride,[c,h]),m=Oe(s,d),y=m.resized,g=m.padding,v=J((function(){var B=V.predictForMultiPersonInstanceSegmentationAndPart(y),$=B.segmentLogits,X=B.longOffsets,tt=B.heatmapScores,et=B.offsets,nt=B.displacementFwd,ut=B.displacementBwd,vt=B.partHeatmaps,lt=Gt($,[c,h],d,[[g.top,g.bottom],[g.left,g.right]]),Rt=Gt(vt,[c,h],d,[[g.top,g.bottom],[g.left,g.right]]),kt=X,Et=Se(Ft(lt),o.segmentationThreshold),ct=(function(ht){var mt=ht.shape,dt=mt[0],Ot=mt[1],jt=mt[2];return J((function(){var It=Xr(ht),Wt=Kt(Hr(0,jt,1,"int32"),1),Bt=Ht(Nr(It,Wt),"int32");return Ce(Bt,[dt,Ot])}))})(Rt);return{segmentation:Et,longOffsets:kt,heatmapScoresRaw:tt,offsetsRaw:et,displacementFwdRaw:nt,displacementBwdRaw:ut,partSegmentation:ct}})),w=v.segmentation,x=v.longOffsets,A=v.heatmapScoresRaw,S=v.offsetsRaw,O=v.displacementFwdRaw,j=v.displacementBwdRaw,F=v.partSegmentation,[4,Te([A,S,O,j])];case 1:return P=G.sent(),k=P[0],T=P[1],I=P[2],C=P[3],H=Me(H=Ae(k,T,I,C,this.baseModel.outputStride,o.maxDetections,o.scoreThreshold,o.nmsRadius),[c,h],d,g,!1),[4,xo(w,x,F,H,c,h,this.baseModel.outputStride,d,g,o.scoreThreshold,o.refineSteps,o.minKeypointScore,o.maxDetections)];case 2:return L=G.sent(),y.dispose(),w.dispose(),x.dispose(),A.dispose(),S.dispose(),O.dispose(),j.dispose(),F.dispose(),[2,L]}}))}))},r.prototype.dispose=function(){this.baseModel.dispose()},r})();function _o(r){return N(this,void 0,void 0,(function(){var s,o,a,c,h,d;return W(this,(function(m){switch(m.label){case 0:if(s=r.outputStride,o=r.quantBytes,a=r.multiplier,Lr==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return c=(function(y,g,v){var w={1:"100",.75:"075",.5:"050"},x="model-stride"+y+".json";return v===4?Tr+"float/"+w[g]+"/"+x:Tr+"quant"+v+"/"+w[g]+"/"+x})(s,a,o),[4,wn(r.modelUrl||c)];case 1:return h=m.sent(),d=new go(h,s),[2,new ri(d)]}}))}))}function Fo(r){return N(this,void 0,void 0,(function(){var s,o,a,c,h;return W(this,(function(d){switch(d.label){case 0:if(s=r.outputStride,o=r.quantBytes,Lr==null)throw new Error(`Cannot find TensorFlow.js. If you are using a <script> tag, please also include @tensorflow/tfjs on the page before using this
        model.`);return a=(function(m,y){var g="model-stride"+m+".json";return y===4?Or+"float/"+g:Or+"quant"+y+"/"+g})(s,o),[4,wn(r.modelUrl||a)];case 1:return c=d.sent(),h=new Mo(c,s),[2,new ri(h)]}}))}))}function Po(r){return r===void 0&&(r=jr),N(this,void 0,void 0,(function(){return W(this,(function(s){return(r=(function(o){if((o=o||jr).architecture==null&&(o.architecture="MobileNetV1"),_r.indexOf(o.architecture)<0)throw new Error("Invalid architecture "+o.architecture+". Should be one of "+_r);if(o.outputStride==null&&(o.outputStride=16),Fr[o.architecture].indexOf(o.outputStride)<0)throw new Error("Invalid outputStride "+o.outputStride+". Should be one of "+Fr[o.architecture]+" for architecture "+o.architecture+".");if(o.multiplier==null&&(o.multiplier=1),Pr[o.architecture].indexOf(o.multiplier)<0)throw new Error("Invalid multiplier "+o.multiplier+". Should be one of "+Pr[o.architecture]+" for architecture "+o.architecture+".");if(o.quantBytes==null&&(o.quantBytes=4),Rr.indexOf(o.quantBytes)<0)throw new Error("Invalid quantBytes "+o.quantBytes+". Should be one of "+Rr+" for architecture "+o.architecture+".");return o})(r)).architecture==="ResNet50"?[2,Fo(r)]:r.architecture==="MobileNetV1"?[2,_o(r)]:[2,null]}))}))}var mn=["left_face","right_face","left_upper_arm_front","left_upper_arm_back","right_upper_arm_front","right_upper_arm_back","left_lower_arm_front","left_lower_arm_back","right_lower_arm_front","right_lower_arm_back","left_hand","right_hand","torso_front","torso_back","left_upper_leg_front","left_upper_leg_back","right_upper_leg_front","right_upper_leg_back","left_lower_leg_front","left_lower_leg_back","right_lower_leg_front","right_lower_leg_back","left_feet","right_feet"],Br=(function(){function r(s){this.mask=s}return r.prototype.toCanvasImageSource=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Sn(this.mask)]}))}))},r.prototype.toImageData=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,this.mask]}))}))},r.prototype.toTensor=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Kr(this.mask)]}))}))},r.prototype.getUnderlyingType=function(){return"imagedata"},r})();function Ro(r){if(ae(r),r!==255)throw new Error("Foreground id must be 255 but got "+r);return"person"}function ko(r){if(ae(r),r>=mn.length)throw new Error("Invalid body part value "+r);return mn[r]}var Io=(function(){function r(s){this.bodyPixModel=s}return r.prototype.segmentPeople=function(s,o){return N(this,void 0,void 0,(function(){var a,c,h,d;return W(this,(function(m){switch(m.label){case 0:return s instanceof ImageBitmap&&((a=document.createElement("canvas")).getContext("2d").drawImage(s,0,0),s=a),o.segmentBodyParts?o.multiSegmentation?[4,this.bodyPixModel.segmentMultiPersonParts(s,o)]:[3,2]:[3,5];case 1:return h=m.sent(),[3,4];case 2:return[4,this.bodyPixModel.segmentPersonParts(s,o)];case 3:h=[m.sent()],m.label=4;case 4:return c=h.map((function(y){var g=y.data,v=y.width,w=y.height,x=new Uint8ClampedArray(v*w*4).fill(0);return g.forEach((function(A,S){A===-1?(x[4*S]=mn.length,x[4*S+3]=0):(x[4*S]=A,x[4*S+3]=255)})),{maskValueToLabel:ko,mask:new Br(new ImageData(x,v,w))}})),[3,10];case 5:return o.multiSegmentation?[4,this.bodyPixModel.segmentMultiPerson(s,o)]:[3,7];case 6:return d=m.sent(),[3,9];case 7:return[4,this.bodyPixModel.segmentPerson(s,o)];case 8:d=[m.sent()],m.label=9;case 9:c=d.map((function(y){var g=y.data,v=y.width,w=y.height,x=new Uint8ClampedArray(v*w*4).fill(0);return g.forEach((function(A,S){A===0?(x[4*S]=0,x[4*S+3]=0):(x[4*S]=255,x[4*S+3]=255)})),{maskValueToLabel:Ro,mask:new Br(new ImageData(x,v,w))}})),m.label=10;case 10:return[2,c]}}))}))},r.prototype.dispose=function(){this.bodyPixModel.dispose()},r.prototype.reset=function(){},r})();function Bo(r){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Po(r).then((function(o){return new Io(o)}))]}))}))}var Cr={runtime:"mediapipe",modelType:"general"},Co=(function(){function r(s){this.mask=s}return r.prototype.toCanvasImageSource=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,this.mask]}))}))},r.prototype.toImageData=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Gr(this.mask)]}))}))},r.prototype.toTensor=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Kr(this.mask)]}))}))},r.prototype.getUnderlyingType=function(){return"canvasimagesource"},r})();function Uo(r){return ae(r),"person"}var Do=(function(){function r(s){var o,a=this;this.selfieMode=!1;var c;this.selfieSegmentationSolution=new vo.SelfieSegmentation({locateFile:(o=s.locateFile)!==null&&o!==void 0?o:function(h,d){return s.solutionPath?s.solutionPath.replace(/\/+$/,"")+"/"+h:d+"/"+h}}),s.modelType==="landscape"?c=1:c=0,this.selfieSegmentationSolution.setOptions({modelSelection:c,selfieMode:this.selfieMode}),this.selfieSegmentationSolution.onResults((function(h){a.segmentation=[{maskValueToLabel:Uo,mask:new Co(h.segmentationMask)}]}))}return r.prototype.segmentPeople=function(s,o){return N(this,void 0,void 0,(function(){var a,c;return W(this,(function(h){switch(h.label){case 0:return o&&o.flipHorizontal&&o.flipHorizontal!==this.selfieMode&&(this.selfieMode=o.flipHorizontal,this.selfieSegmentationSolution.setOptions({selfieMode:this.selfieMode})),s instanceof Mt?(c=ImageData.bind,[4,Be(s)]):[3,2];case 1:return a=new(c.apply(ImageData,[void 0,h.sent(),s.shape[1],s.shape[0]])),[3,3];case 2:a=s,h.label=3;case 3:return s=a,[4,this.selfieSegmentationSolution.send({image:s})];case 4:return h.sent(),[2,this.segmentation]}}))}))},r.prototype.dispose=function(){this.selfieSegmentationSolution.close()},r.prototype.reset=function(){this.selfieSegmentationSolution.reset(),this.segmentation=null,this.selfieMode=!1},r.prototype.initialize=function(){return this.selfieSegmentationSolution.initialize()},r})();function Lo(r){return N(this,void 0,void 0,(function(){var s,o;return W(this,(function(a){switch(a.label){case 0:return s=(function(c){if(c==null)return ot({},Cr);var h=ot({},c);return h.runtime="mediapipe",h.modelType==null&&(h.modelType=Cr.modelType),h})(r),[4,(o=new Do(s)).initialize()];case 1:return a.sent(),[2,o]}}))}))}function Ho(r,s,o,a){var c=r.width,h=r.height,d=1,m=Math.cos(r.rotation),y=Math.sin(r.rotation),g=r.xCenter,v=r.yCenter,w=1/s,x=1/o,A=new Array(16);return A[0]=c*m*d*w,A[1]=-h*y*w,A[2]=0,A[3]=(-.5*c*m*d+.5*h*y+g)*w,A[4]=c*y*d*x,A[5]=h*m*x,A[6]=0,A[7]=(-.5*h*m-.5*c*y*d+v)*x,A[8]=0,A[9]=0,A[10]=c*w,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,(function(S){if(S.length!==16)throw new Error("Array length must be 16 but got "+S.length);return[[S[0],S[1],S[2],S[3]],[S[4],S[5],S[6],S[7]],[S[8],S[9],S[10],S[11]],[S[12],S[13],S[14],S[15]]]})(A)}function ii(r){return r instanceof Mt?{height:r.shape[0],width:r.shape[1]}:{height:r.height,width:r.width}}function No(r,s){oe(r.width!==0,(function(){return s+" width cannot be 0."})),oe(r.height!==0,(function(){return s+" height cannot be 0."}))}function Wo(r,s){var o=(function(a,c,h,d){var m=c-a,y=d-h,g=y/m;return{scale:g,offset:h-a*g}})(0,255,s[0],s[1]);return J((function(){return Ie(xn(r,o.scale),o.offset)}))}function zo(r,s,o){var a=s.outputTensorSize,c=s.outputTensorFloatRange,h=ii(r),d=(function(v,w){return{xCenter:.5*v.width,yCenter:.5*v.height,width:v.width,height:v.height,rotation:0}})(h),m=(function(v,w,x){return{top:0,left:0,right:0,bottom:0}})(),y=Ho(d,h.width,h.height),g=J((function(){var v,w=(v=r)instanceof Mt?v:bn(v),x=oo((function(O,j,F){return No(F,"inputResolution"),[1/F.width*O[0][0]*j.width,1/F.height*O[0][1]*j.width,O[0][3]*j.width,1/F.width*O[1][0]*j.height,1/F.height*O[1][1]*j.height,O[1][3]*j.height,0,0]})(y,h,a),[1,8]),A="constant",S=se.transform(Kt(Ht(w,"float32")),x,"bilinear",A,0,[a.height,a.width]);return c!=null?Wo(S,c):S}));return{imageTensor:g,padding:m,transformationMatrix:y}}function Vo(r,s,o){return J((function(){var a=Ft(r,[0]),c=a.shape[2];if(c===1){var h=a;switch(s.activation){case"none":break;case"sigmoid":h=gn(h);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+s.activation+")")}var d=o?se.resizeBilinear(h,[o.height,o.width]):h;return Ft(d,[2])}throw new Error("Unsupported number of tensor channels "+c)}))}var Ur={runtime:"tfjs",modelType:"general",modelUrl:"https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1"},Dr={flipHorizontal:!1},Go={outputTensorSize:{width:256,height:256},outputTensorFloatRange:[0,1]},Ko={outputTensorSize:{width:256,height:144},outputTensorFloatRange:[0,1]},Xo={activation:"none"},Yo=(function(){function r(s){this.mask=s}return r.prototype.toCanvasImageSource=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Sn(this.mask)]}))}))},r.prototype.toImageData=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,Gr(this.mask)]}))}))},r.prototype.toTensor=function(){return N(this,void 0,void 0,(function(){return W(this,(function(s){return[2,this.mask]}))}))},r.prototype.getUnderlyingType=function(){return"tensor"},r})();function Qo(r){return ae(r),"person"}var Re,Zo=(function(){function r(s,o){this.modelType=s,this.model=o}return r.prototype.segmentPeople=function(s,o){return N(this,void 0,void 0,(function(){var a,c=this;return W(this,(function(h){return o=(function(d){if(d==null)return ot({},Dr);var m=ot({},d);return m.flipHorizontal==null&&(m.flipHorizontal=Dr.flipHorizontal),m})(o),s==null?(this.reset(),[2,[]]):(a=J((function(){var d=zo(s,c.modelType==="general"?Go:Ko).imageTensor,m=no(c.model.predict(d),[0,0,0,1],-1),y=ii(s),g=Vo(m,Xo,y),v=Kt(g,2),w=ro(v,[[0,0],[0,0],[0,1]]);return io(w,[[0,0],[0,0],[0,2]],"symmetric")})),[2,[{maskValueToLabel:Qo,mask:new Yo(a)}]])}))}))},r.prototype.dispose=function(){this.model.dispose()},r.prototype.reset=function(){},r})();function $o(r){return N(this,void 0,void 0,(function(){var s,o,a;return W(this,(function(c){switch(c.label){case 0:return s=(function(h){if(h==null)return ot({},Ur);var d=ot({},h);if(d.runtime="tfjs",d.modelType==null&&(d.modelType=Ur.modelType),d.modelType!=="general"&&d.modelType!=="landscape")throw new Error("Model type must be one of general or landscape, but got "+d.modelType);return d.modelUrl==null&&(d.modelType==="general"?d.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/general/1":d.modelUrl="https://tfhub.dev/mediapipe/tfjs-model/selfie_segmentation/landscape/1"),d})(r),o=typeof s.modelUrl=="string"&&s.modelUrl.indexOf("https://tfhub.dev")>-1,[4,wn(s.modelUrl,{fromTFHub:o})];case 1:return a=c.sent(),[2,new Zo(s.modelType,a)]}}))}))}function Os(r,s){return N(this,void 0,void 0,(function(){var o,a;return W(this,(function(c){switch(r){case Re.MediaPipeSelfieSegmentation:if(o=void 0,(a=s)!=null){if(a.runtime==="tfjs")return[2,$o(a)];if(a.runtime==="mediapipe")return[2,Lo(a)];o=a.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+o);case Re.BodyPix:return[2,Bo(a=s)];default:throw new Error(r+" is not a supported model name.")}}))}))}(function(r){r.BodyPix="BodyPix",r.MediaPipeSelfieSegmentation="MediaPipeSelfieSegmentation"})(Re||(Re={}));var oi="blurred",De="blurred-mask",Le="mask",Jo="lowres-part-mask",qo="draw-image",pn={};function si(r,s,o,a){var c=r.width,h=r.height,d=s.width,m=s.height;if(c!==d||h!==m)throw new Error("error: dimensions must match. "+o+" has dimensions "+c+"x"+h+", "+a+" has dimensions "+d+"x"+m)}function Nt(r){if(typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return(function(s){if("offsetHeight"in s&&s.offsetHeight!==0&&"offsetWidth"in s&&s.offsetWidth!==0)return[s.offsetHeight,s.offsetWidth];if(s.height!=null&&s.width!=null)return[s.height,s.width];throw new Error("HTMLImageElement must have height and width attributes set.")})(r);if(typeof ImageData<"u"&&r instanceof ImageData)return[r.height,r.width];if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return(function(s){return s.hasAttribute("height")&&s.hasAttribute("width")?[s.height,s.width]:[s.videoHeight,s.videoWidth]})(r);if(r instanceof Mt)return[r.shape[0],r.shape[1]];throw new Error("error: Unknown input type: "+r+".")}function En(r){return pn[r]||(pn[r]=(function(){if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(0,0);throw new Error("Cannot create a canvas in this context")})()),pn[r]}function fe(r,s){var o=En(s);return(function(a,c){c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a,0,0)})(r,o),o}function Pt(r,s,o,a,c,h){return N(this,void 0,void 0,(function(){var d,m,y,g;return W(this,(function(v){switch(v.label){case 0:return s instanceof Mt?[4,Be(s)]:[3,2];case 1:d=v.sent(),m=Nt(s),y=m[0],g=m[1],s=new ImageData(d,g,y),v.label=2;case 2:return s instanceof ImageData&&(s=fe(s,qo)),c==null||h==null?r.drawImage(s,o,a):r.drawImage(s,o,a,c,h),[2]}}))}))}function ts(r,s){return N(this,void 0,void 0,(function(){var o,a,c;return W(this,(function(h){switch(h.label){case 0:return o=Nt(r),a=o[0],c=o[1],s.width=c,s.height=a,[4,Pt(s.getContext("2d"),r,0,0,c,a)];case 1:return h.sent(),[2]}}))}))}function He(r){var s=r.getContext("2d");s.scale(-1,1),s.translate(-r.width,0)}function ke(r,s,o){return N(this,void 0,void 0,(function(){return W(this,(function(a){switch(a.label){case 0:return r.globalCompositeOperation=o,[4,Pt(r,s,0,0)];case 1:return a.sent(),[2]}}))}))}function es(r,s,o){return N(this,void 0,void 0,(function(){var a,c,h,d,m,y,g,v;return W(this,(function(w){switch(w.label){case 0:for(a=r.getContext("2d"),c=0,h=5,d=1/(2*Math.PI*h*h),m=o<3?1:2,g=-o;g<=o;g+=m)for(v=-o;v<=o;v+=m)y=d*Math.exp(-(v*v+g*g)/(2*h*h)),c+=y;g=-o,w.label=1;case 1:if(!(g<=o))return[3,6];v=-o,w.label=2;case 2:return v<=o?(a.globalAlpha=d*Math.exp(-(v*v+g*g)/(2*h*h))/c*o,[4,Pt(a,s,v,g)]):[3,5];case 3:w.sent(),w.label=4;case 4:return v+=m,[3,2];case 5:return g+=m,[3,1];case 6:return a.globalAlpha=1,[2]}}))}))}function ns(r,s,o){return N(this,void 0,void 0,(function(){var a,c,h,d;return W(this,(function(m){switch(m.label){case 0:return a=Nt(r),c=a[0],h=a[1],d=o.getContext("2d"),o.width=h,o.height=c,d.clearRect(0,0,h,c),d.save(),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?[4,es(o,r,s)]:[3,2];case 1:return m.sent(),[3,4];case 2:return d.filter="blur("+s+"px)",[4,Pt(d,r,0,0,h,c)];case 3:m.sent(),m.label=4;case 4:return d.restore(),[2]}}))}))}function Xt(r,s,o){return N(this,void 0,void 0,(function(){var a;return W(this,(function(c){switch(c.label){case 0:return a=En(o),s!==0?[3,2]:[4,ts(r,a)];case 1:return c.sent(),[3,4];case 2:return[4,ns(r,s,a)];case 3:c.sent(),c.label=4;case 4:return[2,a]}}))}))}function rs(r,s,o,a,c,h){h===void 0&&(h={r:0,g:255,b:255,a:255});for(var d=-c;d<=c;d++)for(var m=-c;m<=c;m++)if(d!==0&&m!==0){var y=(s+d)*a+(o+m);r[4*y+0]=h.r,r[4*y+1]=h.g,r[4*y+2]=h.b,r[4*y+3]=h.a}}function is(r,s,o,a,c,h,d){d===void 0&&(d=1);for(var m=0,y=-d;y<=d;y++)for(var g=-d;g<=d;g++)if(y!==0&&g!==0){var v=(s+y)*a+(o+g);(!c[r[4*v]]||r[4*v+3]<h)&&(m+=1)}return m>0}function ui(r,s,o,a,c,h){return s===void 0&&(s={r:0,g:0,b:0,a:0}),o===void 0&&(o={r:0,g:0,b:0,a:255}),a===void 0&&(a=!1),c===void 0&&(c=.5),h===void 0&&(h=Array.from(Array(256).keys())),N(this,void 0,void 0,(function(){var d,m,y,g,v,w,x,A,S,O,j,F,P,k;return W(this,(function(T){switch(T.label){case 0:return(d=Array.isArray(r)?r:[r]).length===0?[2,null]:[4,Promise.all(d.map((function(I){return I.mask.toImageData()})))];case 1:for(m=T.sent(),y=m[0],g=y.width,v=y.height,w=new Uint8ClampedArray(g*v*4),x=Math.round(255*c),A=new Array(256).fill(!1),h.forEach((function(I){return A[I]=!0})),S=0;S<v;S++)for(O=0;O<g;O++)for(w[4*(j=S*g+O)+0]=o.r,w[4*j+1]=o.g,w[4*j+2]=o.b,w[4*j+3]=o.a,F=0,P=m;F<P.length;F++)k=P[F],A[k.data[4*j]]&&k.data[4*j+3]>=x&&(w[4*j]=s.r,w[4*j+1]=s.g,w[4*j+2]=s.b,w[4*j+3]=s.a,a&&S-1>=0&&S+1<v&&O-1>=0&&O+1<g&&is(k.data,S,O,g,A,x)&&rs(w,S,O,g,1));return[2,new ImageData(w,g,v)]}}))}))}function Ts(r,s,o,a){return o===void 0&&(o={r:0,g:0,b:0,a:255}),a===void 0&&(a=.5),N(this,void 0,void 0,(function(){var c,h,d,m,y,g,v,w,x,A,S,O,j,F;return W(this,(function(P){switch(P.label){case 0:return(c=Array.isArray(r)?r:[r]).length===0?[2,null]:[4,Promise.all(c.map((function(k){return k.mask.toImageData()})))];case 1:for(h=P.sent(),d=h[0],m=d.width,y=d.height,g=new Uint8ClampedArray(m*y*4),v=Math.round(255*a),w=0;w<y*m;++w)for(g[(x=4*w)+0]=o.r,g[x+1]=o.g,g[x+2]=o.b,g[x+3]=o.a,A=0,S=h;A<S.length;A++)(O=S[A]).data[x+3]>=v&&(j=O.data[x],F=s(j),g[x+0]=F.r,g[x+1]=F.g,g[x+2]=F.b,g[x+3]=F.a);return[2,new ImageData(g,m,y)]}}))}))}function Ms(r,s,o,a,c,h){return a===void 0&&(a=.7),c===void 0&&(c=0),h===void 0&&(h=!1),N(this,void 0,void 0,(function(){var d,m,y,g,v;return W(this,(function(w){switch(w.label){case 0:return d=Nt(s),m=d[0],y=d[1],r.width=y,r.height=m,(g=r.getContext("2d")).save(),h&&He(r),[4,Pt(g,s,0,0)];case 1:return w.sent(),g.globalAlpha=a,o?(si({width:y,height:m},o,"image","mask"),[4,Xt(fe(o,Le),c,De)]):[3,3];case 2:v=w.sent(),g.drawImage(v,0,0,y,m),w.label=3;case 3:return g.restore(),[2]}}))}))}function js(r,s,o,a,c,h,d){return a===void 0&&(a=.7),c===void 0&&(c=0),h===void 0&&(h=!1),d===void 0&&(d=10),N(this,void 0,void 0,(function(){var m,y,g,v,w,x,A;return W(this,(function(S){switch(S.label){case 0:return m=Nt(s),y=m[0],si({width:m[1],height:y},o,"image","mask"),[4,Xt(fe(o,Le),c,De)];case 1:for(g=S.sent(),r.width=g.width,r.height=g.height,(v=r.getContext("2d")).save(),h&&He(r),w=En(Jo),x=w.getContext("2d"),w.width=g.width*(1/d),w.height=g.height*(1/d),x.drawImage(g,0,0,g.width,g.height,0,0,w.width,w.height),v.imageSmoothingEnabled=!1,v.drawImage(w,0,0,w.width,w.height,0,0,r.width,r.height),A=0;A<w.width;A++)v.beginPath(),v.strokeStyle="#ffffff",v.moveTo(d*A,0),v.lineTo(d*A,r.height),v.stroke();for(A=0;A<w.height;A++)v.beginPath(),v.strokeStyle="#ffffff",v.moveTo(0,d*A),v.lineTo(r.width,d*A),v.stroke();return v.globalAlpha=1-a,[4,Pt(v,s,0,0,g.width,g.height)];case 2:return S.sent(),v.restore(),[2]}}))}))}function os(r,s,o){return N(this,void 0,void 0,(function(){var a,c;return W(this,(function(h){switch(h.label){case 0:return[4,ui(r,{r:0,g:0,b:0,a:255},{r:0,g:0,b:0,a:0},!1,s)];case 1:return a=h.sent(),c=fe(a,Le),o===0?[2,c]:[2,Xt(c,o,De)]}}))}))}function _s(r,s,o,a,c,h,d){return a===void 0&&(a=.5),c===void 0&&(c=3),h===void 0&&(h=3),d===void 0&&(d=!1),N(this,void 0,void 0,(function(){var m,y,g,v,w,x;return W(this,(function(A){switch(A.label){case 0:return[4,Xt(s,c,oi)];case 1:return m=A.sent(),r.width=m.width,r.height=m.height,y=r.getContext("2d"),Array.isArray(o)&&o.length===0?(y.drawImage(m,0,0),[2]):[4,os(o,a,h)];case 2:return g=A.sent(),y.save(),d&&He(r),v=Nt(s),w=v[0],x=v[1],[4,Pt(y,s,0,0,x,w)];case 3:return A.sent(),[4,ke(y,g,"destination-in")];case 4:return A.sent(),[4,ke(y,m,"destination-over")];case 5:return A.sent(),y.restore(),[2]}}))}))}function ss(r,s,o,a){return N(this,void 0,void 0,(function(){var c,h;return W(this,(function(d){switch(d.label){case 0:return[4,ui(r,{r:0,g:0,b:0,a:0},{r:0,g:0,b:0,a:255},!0,o,s)];case 1:return c=d.sent(),h=fe(c,Le),a===0?[2,h]:[2,Xt(h,a,De)]}}))}))}function Fs(r,s,o,a,c,h,d,m){return c===void 0&&(c=.5),h===void 0&&(h=3),d===void 0&&(d=3),m===void 0&&(m=!1),N(this,void 0,void 0,(function(){var y,g,v,w,x,A;return W(this,(function(S){switch(S.label){case 0:return[4,Xt(s,h,oi)];case 1:return y=S.sent(),r.width=y.width,r.height=y.height,g=r.getContext("2d"),Array.isArray(o)&&o.length===0?(g.drawImage(y,0,0),[2]):[4,ss(o,a,c,d)];case 2:return v=S.sent(),g.save(),m&&He(r),w=Nt(s),x=w[0],A=w[1],[4,Pt(g,s,0,0,A,x)];case 3:return S.sent(),[4,ke(g,v,"destination-in")];case 4:return S.sent(),[4,ke(g,y,"destination-over")];case 5:return S.sent(),g.restore(),[2]}}))}))}export{Re as SupportedModels,Fs as blurBodyPart,Es as bodyPixMaskValueToRainbowColor,Os as createSegmenter,_s as drawBokehEffect,Ms as drawMask,js as drawPixelatedMask,ui as toBinaryMask,Ts as toColoredMask};
